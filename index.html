<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Lead Studio Pro — YouTube Channel Finder</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* =========================
         THEME — Apple-ish + Purple
         ========================= */
      :root{
        --bg-0:#07080c;            /* page base */
        --bg-1:#0b0d14;            /* panels */
        --bg-2:#0f1320;            /* deeper */
        --glass: rgba(255,255,255,.06);
        --glass-2: rgba(255,255,255,.08);
        --muted:#a6b0c3;
        --text:#f5f7ff;
        --accent:#7c3aed;          /* purple */
        --accent-2:#a78bfa;        /* light purple */
        --ok:#22c55e;              /* green */
        --warn:#f59e0b;            /* amber */
        --danger:#ef4444;
        --radius:14px;
        --radius-sm:10px;
        --shadow: 0 30px 70px rgba(0,0,0,.45);
      }
    
      /* Base reset */
      * { box-sizing:border-box; }
      html,body { height:100%; }
      body {
        margin:0;
        padding:0;
        background-color: var(--bg-0);
        color: var(--text);
        font-family: 'Inter', sans-serif;
        font-size:16px;
        line-height:1.6;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        display:flex;
        flex-direction:column;
        justify-content:center;
        align-items:center;
        padding:2rem;
        min-height:100vh;
      }
      
      /* Login/Signup UI */
      .auth-container {
          background: var(--glass);
          backdrop-filter: blur(10px);
          border: 1px solid var(--glass-2);
          box-shadow: var(--shadow);
          border-radius: var(--radius);
          padding: 2rem;
          width: 100%;
          max-width: 400px;
          display: flex;
          flex-direction: column;
          align-items: center;
      }
      
      .auth-container h1 {
          font-size: 2.5rem;
          font-weight: 700;
          margin-bottom: 1.5rem;
          color: var(--accent);
          text-align: center;
      }
      
      .auth-form input {
          width: 100%;
          padding: 0.75rem 1rem;
          border: 1px solid rgba(255, 255, 255, 0.1);
          background-color: rgba(255, 255, 255, 0.05);
          border-radius: var(--radius-sm);
          color: var(--text);
          font-size: 1rem;
          margin-bottom: 1rem;
          transition: border-color 0.2s;
      }
      .auth-form input:focus {
          outline: none;
          border-color: var(--accent);
      }
      
      .auth-btn {
          width: 100%;
          padding: 0.75rem 1.5rem;
          font-weight: 600;
          font-size: 1rem;
          border-radius: var(--radius-sm);
          transition: all 0.3s ease;
          cursor: pointer;
      }

      .auth-btn.primary {
          background-color: var(--accent);
          color: var(--text);
          box-shadow: 0 4px 15px rgba(124, 58, 237, 0.4);
      }
      
      .auth-btn.primary:hover {
          background-color: var(--accent-2);
          box-shadow: 0 6px 20px rgba(167, 139, 250, 0.6);
      }
      
      .auth-status {
          font-size: 0.875rem;
          color: var(--muted);
          text-align: center;
          margin-top: 1rem;
      }
      
      .auth-toggle {
          font-size: 0.875rem;
          color: var(--accent);
          text-decoration: none;
          margin-top: 1rem;
          cursor: pointer;
      }
      
      .auth-toggle:hover {
          text-decoration: underline;
      }
      
      /* Main app UI styles */
      #main {
        max-width:1400px;
        width:100%;
        display:flex;
        flex-direction:column;
        gap:2rem;
        transition: transform 0.5s ease-in-out;
        transform: scale(0.9);
        opacity: 0;
        pointer-events: none;
      }
      #main.active {
        transform: scale(1);
        opacity: 1;
        pointer-events: auto;
      }

      .panel{
        background-color: var(--bg-1);
        border:1px solid var(--glass-2);
        border-radius: var(--radius);
        padding:1.5rem;
        display:flex;
        flex-direction:column;
        gap:1rem;
      }

      header{
        display:flex;
        align-items:center;
        justify-content:space-between;
      }
      h1{
        font-size:1.5rem;
        font-weight:700;
      }
      h2{
        font-size:1rem;
        font-weight:600;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing:1px;
      }
      .panel h2, .panel h3{ margin-bottom:0.5rem; }
      .search-form { display:flex; gap:1rem; }
      input, select, button{
        font:inherit;
        border-radius:var(--radius-sm);
        padding:0.5rem 1rem;
        border:1px solid rgba(255,255,255,.1);
        background-color: var(--bg-2);
        color: var(--text);
      }
      input[type="text"], input[type="email"], input[type="password"] { flex-grow:1; }
      button{
        background-color: var(--accent);
        border-color: var(--accent);
        cursor:pointer;
        transition:all .2s ease;
      }
      button:hover{
        background-color: var(--accent-2);
        border-color: var(--accent-2);
      }
      button:disabled{
        opacity:0.5;
        cursor:not-allowed;
      }
      #results{
        display:flex;
        flex-direction:column;
      }
      #results table{
        width:100%;
        border-collapse:collapse;
        font-size:0.875rem;
      }
      #results th, #results td{
        padding:0.75rem 1rem;
        text-align:left;
        border-bottom:1px solid rgba(255,255,255,.05);
      }
      #results th{
        color:var(--muted);
        text-transform:uppercase;
        font-size:0.75rem;
        font-weight:500;
        white-space:nowrap;
      }
      #results tr:hover{
        background-color:rgba(255,255,255,.05);
        cursor:pointer;
      }
      #results .channel-name{
        display:flex;
        align-items:center;
        gap:0.75rem;
      }
      #results .channel-name img{
        width:32px;
        height:32px;
        border-radius:50%;
      }
      .meta{
        font-size:0.875rem;
        color:var(--muted);
        text-align:center;
        padding:2rem;
      }
      .socials{
        display:flex;
        gap:0.5rem;
      }
      .socials a{
        width:24px;
        height:24px;
        display:flex;
        align-items:center;
        justify-content:center;
        color:var(--muted);
        transition:color .2s ease;
      }
      .socials a:hover{
        color:var(--accent-2);
      }
      .progress-bar{
        height:8px;
        background-color:var(--bg-2);
        border-radius:var(--radius-sm);
        overflow:hidden;
      }
      .progress-bar div{
        height:100%;
        width:0%;
        background-color:var(--accent);
        transition:width .3s ease;
      }
      #detail-view{
        position:sticky;
        top:2rem;
        height:fit-content;
      }
      #detail-view img{
        width:100%;
        height:auto;
        border-radius:var(--radius);
        margin-bottom:1rem;
        display:none;
      }
      .btn-group{
        display:flex;
        gap:0.5rem;
      }
      .btn-icon{
        padding:0.5rem;
        width:40px;
        height:40px;
        display:flex;
        align-items:center;
        justify-content:center;
      }
      .status-box{
        display:flex;
        align-items:center;
        gap:0.5rem;
        font-size:0.875rem;
        color:var(--muted);
      }
      .status-box .dot{
        width:8px;
        height:8px;
        border-radius:50%;
        background-color:var(--ok);
      }
      .dot.warn{ background-color:var(--warn); }
      .dot.danger{ background-color:var(--danger); }
      
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        visibility: hidden;
        opacity: 0;
        transition: visibility 0s, opacity 0.3s ease;
      }
      .modal.show {
        visibility: visible;
        opacity: 1;
      }
      .modal-content {
        background: var(--bg-1);
        border-radius: var(--radius);
        padding: 2rem;
        max-width: 400px;
        text-align: center;
      }
      .modal-close-btn {
        margin-top: 1rem;
        background: var(--accent);
        color: var(--text);
        padding: 0.75rem 1.5rem;
        border-radius: var(--radius-sm);
        cursor: pointer;
      }
      
      .logout-btn {
        background: var(--bg-2);
        color: var(--muted);
        border: 1px solid var(--glass-2);
        padding: 0.5rem 1rem;
        border-radius: var(--radius-sm);
        cursor: pointer;
        transition: all 0.2s ease;
      }
      .logout-btn:hover {
        background: var(--glass);
        color: var(--text);
      }
      .user-id-display {
          font-size: 0.75rem;
          color: var(--muted);
          word-break: break-all;
          text-align: center;
          margin-top: 1rem;
      }

      /* Responsive */
      @media (min-width: 768px){
        body{
          padding:4rem;
        }
        #main{
          flex-direction:row;
        }
        #results{
          flex:2;
        }
        #detail-view{
          flex:1;
        }
      }
    </style>
</head>
<body>

    <!-- Modal for Custom Alerts -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-title"></h3>
            <p id="modal-message"></p>
            <button id="modal-close-btn" class="modal-close-btn">OK</button>
        </div>
    </div>
    
    <!-- Login/Signup UI -->
    <div id="authContainer" class="auth-container">
        <h1>Welcome</h1>
        <form id="authForm" class="auth-form">
            <input type="email" id="emailField" placeholder="Email" required>
            <input type="password" id="passwordField" placeholder="Password" required>
            <button type="submit" id="authButton" class="auth-btn primary">Sign In</button>
        </form>
        <p id="authStatus" class="auth-status"></p>
        <a id="authToggle" class="auth-toggle">Need an account? Sign Up</a>
    </div>

    <!-- Main App UI -->
    <div id="main" class="hidden">
      <div id="results" class="panel">
        <header>
          <h1>YouTube Channels</h1>
          <button class="logout-btn" id="logoutBtn">
            Logout
          </button>
          <div class="btn-group">
            <button class="btn-icon" id="btnLoadLib">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
            </button>
            <button class="btn-icon" id="btnSaveLib">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
            </button>
            <button class="btn-icon" onclick="copyResults()">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
            </button>
          </div>
        </header>

        <form id="searchForm" class="search-form">
          <input type="text" id="keywords" placeholder="Enter keywords to search..." value="fitness, health, yoga">
          <select id="country">
            <option value="">Any Country</option>
            <option value="US">USA</option>
            <option value="GB">UK</option>
            <option value="CA">Canada</option>
            <option value="AU">Australia</option>
          </select>
          <button type="submit" id="searchBtn">
            <span id="searchBtnText">Search (10 Credits)</span>
          </button>
        </form>

        <div class="progress-bar">
          <div id="progressBar" style="width:0%;"></div>
        </div>

        <div class="status-box">
          <span class="dot" id="statusDot"></span>
          <span id="statusMessage">Idle</span>
          <span id="creditBalance">Credits: 0</span>
        </div>
        
        <table id="resultsTable">
          <thead>
            <tr>
              <th>Channel Name</th>
              <th>Subscribers</th>
              <th>Country</th>
              <th>Socials</th>
            </tr>
          </thead>
          <tbody id="resultsTbody">
            <tr class="meta-row">
              <td colspan="4">
                <div class="meta">No search results yet.</div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div id="detail-view" class="panel">
        <h2 id="detailTitle">Select a channel</h2>
        <div id="detailContent">
          <div class="meta">No channel selected.</div>
        </div>
      </div>
    </div>
    
    <!-- Firebase Scripts -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-functions.js";
        
        // --- GLOBALS ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let app, auth, db, functions, isAuthReady = false, userId;
        
        // --- UI ELEMENTS ---
        const $ = s => document.getElementById(s);
        const authContainer = $('authContainer');
        const mainContainer = $('main');
        const authForm = $('authForm');
        const emailField = $('emailField');
        const passwordField = $('passwordField');
        const authButton = $('authButton');
        const authStatus = $('authStatus');
        const authToggle = $('authToggle');
        
        const searchForm = $('searchForm');
        const searchBtn = $('searchBtn');
        const searchBtnText = $('searchBtnText');
        const keywordsInput = $('keywords');
        const countrySelect = $('country');
        const statusMessage = $('statusMessage');
        const statusDot = $('statusDot');
        const progressBar = $('progressBar');
        const creditBalanceSpan = $('creditBalance');
        const resultsTbody = $('resultsTbody');
        const logoutBtn = $('logoutBtn');
        
        let isLogin = true;
        
        // Modal elements
        const modal = $('modal');
        const modalTitle = $('modal-title');
        const modalMessage = $('modal-message');
        const modalCloseBtn = $('modal-close-btn');
        
        function showModal(title, message) {
            modalTitle.innerText = title;
            modalMessage.innerText = message;
            modal.classList.add('show');
        }
        
        modalCloseBtn.addEventListener('click', () => {
            modal.classList.remove('show');
        });

        // --- FIREBASE INITIALIZATION ---
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            functions = getFunctions(app, 'europe-west1');
        } catch (error) {
            console.error("Firebase initialization error:", error);
            showModal("Initialization Error", "Failed to initialize Firebase. Please check the console for details.");
        }
        
        // --- AUTHENTICATION ---
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userId = user.uid;
                isAuthReady = true;
                authContainer.style.display = 'none';
                mainContainer.classList.add('active');
                
                // Real-time listener for user credits
                onSnapshot(doc(db, 'users', user.uid), (docSnapshot) => {
                    if (docSnapshot.exists()) {
                        const data = docSnapshot.data();
                        creditBalanceSpan.innerText = `Credits: ${data.credits || 0}`;
                    } else {
                        setDoc(doc(db, 'users', user.uid), { credits: 100 });
                        creditBalanceSpan.innerText = `Credits: 100`;
                    }
                });
            } else {
                isAuthReady = true;
                authContainer.style.display = 'flex';
                mainContainer.classList.remove('active');
            }
        });
        
        authForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = emailField.value;
            const password = passwordField.value;
            authButton.disabled = true;
            authStatus.innerText = 'Processing...';
        
            try {
                if (isLogin) {
                    await signInWithEmailAndPassword(auth, email, password);
                } else {
                    await createUserWithEmailAndPassword(auth, email, password);
                }
                authStatus.innerText = '';
            } catch (error) {
                console.error("Auth Error:", error);
                const errorMessage = isLogin ? 'Sign in failed. Invalid email or password.' : 'Sign up failed. Please try a different email or a stronger password.';
                authStatus.innerText = errorMessage;
                showModal("Authentication Failed", errorMessage);
            } finally {
                authButton.disabled = false;
            }
        });
        
        authToggle.addEventListener('click', () => {
            isLogin = !isLogin;
            authButton.innerText = isLogin ? 'Sign In' : 'Sign Up';
            authToggle.innerText = isLogin ? 'Need an account? Sign Up' : 'Already have an account? Sign In';
            authStatus.innerText = '';
        });
        
        logoutBtn.addEventListener('click', async () => {
            await signOut(auth);
            showModal("Logged Out", "You have been successfully logged out.");
        });

        // --- SEARCH FUNCTIONALITY (PLACEHOLDER) ---
        searchForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!auth.currentUser) {
                showModal("Access Denied", "Please sign in to perform a search.");
                return;
            }
            
            const keywords = keywordsInput.value;
            if (keywords.trim() === '') {
                showModal("Invalid Input", "Please enter a search query.");
                return;
            }
        
            searchBtn.disabled = true;
            searchBtnText.innerText = 'Searching...';
            setStatus('Searching...');
            setProgress(0);
        
            // This is a placeholder for your future Cloud Function call
            showModal("Search Initiated", "Credits would be deducted here, but the backend function is currently disabled. Let's work on the UI first!");
            setStatus('Search successful. Credits deducted.');
            setProgress(100);
            
            searchBtn.disabled = false;
            searchBtnText.innerText = 'Search (10 Credits)';
        });
        
        // --- FIRESTORE FUNCTIONS ---
        async function saveChannelsToFirestore(channels) {
            if (!isAuthReady || !userId) {
                showModal("Error", "Authentication is not ready. Please try again.");
                return;
            }
            try {
                const userDocRef = doc(db, 'artifacts', appId, 'users', userId);
                await setDoc(userDocRef, { channels: JSON.stringify(channels) }, { merge: true });
                showModal("Success", `Saved ${channels.length} channels to your cloud storage.`);
            } catch (error) {
                console.error("Error saving channels:", error);
                showModal("Save Failed", "Could not save your channels. Please check the console for details.");
            }
        }
        
        async function loadChannelsFromFirestore() {
            if (!isAuthReady || !userId) {
                showModal("Error", "Authentication is not ready. Please try again.");
                return;
            }
            try {
                const userDocRef = doc(db, 'artifacts', appId, 'users', userId);
                const docSnap = await getDoc(userDocRef);
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    const channels = JSON.parse(data.channels);
                    // Placeholder for rendering the loaded data
                    showModal("Success", `Loaded ${channels.length} channels from cloud storage.`);
                } else {
                    showModal("No Data", "No saved channels found in your cloud storage.");
                }
            } catch (error) {
                console.error("Error loading channels:", error);
                showModal("Load Failed", "Could not load your channels. The data may be corrupted.");
            }
        }
        
        $('btnSaveLib').addEventListener('click', () => {
          // Placeholder for your channel data, as the search is not yet functional.
          const dummyChannels = [{id:1, name:'Channel One'}, {id:2, name:'Channel Two'}];
          if(dummyChannels.length === 0) {
            showModal("No Channels", "There are no channels to save.");
            return;
          }
          saveChannelsToFirestore(dummyChannels);
        });
        
        $('btnLoadLib').addEventListener('click', () => {
          loadChannelsFromFirestore();
        });

        // --- UTILITY FUNCTIONS ---
        function setStatus(msg, type = 'ok') {
          statusMessage.innerText = msg;
          statusDot.className = `dot ${type}`;
        }
        
        function setProgress(p) {
          progressBar.style.width = p + '%';
        }
        
        function copyResults(){
          showModal("Action Blocked", "This feature is for UI only. We'll work on the functionality later.");
        }
        
        document.addEventListener('DOMContentLoaded', () => {
          mainContainer.style.display = 'none';
        });

    </script>
</body>
</html>
