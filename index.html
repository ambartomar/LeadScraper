<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#007AFF">
    <meta name="description" content="Revolutionary YouTube Channel Discovery Platform powered by Advanced AI">
    <title>Lead Studio Pro Next Gen — Revolutionary YouTube Channel Discovery</title>
    
    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://www.googleapis.com" crossorigin>
    
    <!-- Premium fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&family=JetBrains+Mono:wght@100;200;300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Revolutionary Design System -->
    <style>
        /* ==========================================
           REVOLUTIONARY DESIGN SYSTEM - NEXT GENERATION
           ========================================== */
        
        :root {
            /* Ultra-Premium Color Palette */
            --color-primary: #007AFF;
            --color-primary-dark: #0056CC;
            --color-primary-light: #40A6FF;
            --color-secondary: #5856D6;
            --color-secondary-dark: #4B4ACF;
            --color-secondary-light: #7D7AE8;
            
            /* Success & Status Colors */
            --color-success: #34C759;
            --color-success-dark: #248A3D;
            --color-success-light: #5DD679;
            --color-warning: #FF9500;
            --color-warning-dark: #CC7700;
            --color-warning-light: #FFAD33;
            --color-error: #FF3B30;
            --color-error-dark: #CC2E26;
            --color-error-light: #FF6B63;
            --color-info: #5AC8FA;
            --color-info-dark: #32ADE6;
            --color-info-light: #7DCDFF;
            
            /* Advanced Gradients */
            --gradient-primary: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
            --gradient-success: linear-gradient(135deg, #34C759 0%, #5AC8FA 100%);
            --gradient-warning: linear-gradient(135deg, #FF9500 0%, #FF6B35 100%);
            --gradient-error: linear-gradient(135deg, #FF3B30 0%, #FF2D92 100%);
            --gradient-rainbow: linear-gradient(135deg, #007AFF 0%, #5856D6 25%, #34C759 50%, #FF9500 75%, #FF3B30 100%);
            --gradient-mesh: 
                radial-gradient(circle at 20% 50%, rgba(0, 122, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(88, 86, 214, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(52, 199, 89, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 60% 30%, rgba(255, 149, 0, 0.1) 0%, transparent 50%);
            
            /* Dynamic Light Theme */
            --bg-primary: #FFFFFF;
            --bg-secondary: #FAFAFA;
            --bg-tertiary: #F5F5F5;
            --bg-quaternary: #F0F0F0;
            --bg-elevated: rgba(255, 255, 255, 0.8);
            --bg-overlay: rgba(255, 255, 255, 0.95);
            --bg-glass: rgba(255, 255, 255, 0.1);
            --bg-frosted: rgba(255, 255, 255, 0.85);
            --bg-card: #FFFFFF;
            --bg-input: #FFFFFF;
            --bg-sidebar: #FAFAFA;
            
            /* Advanced Text System */
            --text-primary: #1D1D1F;
            --text-secondary: rgba(60, 60, 67, 0.78);
            --text-tertiary: rgba(60, 60, 67, 0.56);
            --text-quaternary: rgba(60, 60, 67, 0.36);
            --text-inverse: #FFFFFF;
            --text-link: var(--color-primary);
            --text-success: var(--color-success);
            --text-warning: var(--color-warning);
            --text-error: var(--color-error);
            
            /* Borders & Dividers */
            --border-light: rgba(0, 0, 0, 0.08);
            --border-medium: rgba(0, 0, 0, 0.12);
            --border-strong: rgba(0, 0, 0, 0.18);
            --border-focus: var(--color-primary);
            --border-error: var(--color-error);
            
            /* Ultra-Premium Shadows */
            --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.04);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --shadow-ultra: 0 32px 64px -12px rgba(0, 0, 0, 0.25);
            --shadow-glow: 0 0 20px rgba(0, 122, 255, 0.3);
            --shadow-focus: 0 0 0 3px rgba(0, 122, 255, 0.1);
            
            /* Revolutionary Spacing Grid */
            --space-0: 0;
            --space-px: 1px;
            --space-0_5: 0.125rem;
            --space-1: 0.25rem;
            --space-1_5: 0.375rem;
            --space-2: 0.5rem;
            --space-2_5: 0.625rem;
            --space-3: 0.75rem;
            --space-3_5: 0.875rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-7: 1.75rem;
            --space-8: 2rem;
            --space-9: 2.25rem;
            --space-10: 2.5rem;
            --space-11: 2.75rem;
            --space-12: 3rem;
            --space-14: 3.5rem;
            --space-16: 4rem;
            --space-20: 5rem;
            --space-24: 6rem;
            --space-28: 7rem;
            --space-32: 8rem;
            --space-36: 9rem;
            --space-40: 10rem;
            
            /* Premium Border Radius */
            --radius-none: 0px;
            --radius-sm: 0.125rem;
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
            --radius-xl: 0.75rem;
            --radius-2xl: 1rem;
            --radius-3xl: 1.5rem;
            --radius-4xl: 2rem;
            --radius-full: 9999px;
            
            /* Revolutionary Typography */
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            --font-mono: 'JetBrains Mono', 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, monospace;
            
            /* Perfect Font Scale */
            --text-xs: 0.75rem;
            --text-sm: 0.875rem;
            --text-base: 1rem;
            --text-lg: 1.125rem;
            --text-xl: 1.25rem;
            --text-2xl: 1.5rem;
            --text-3xl: 1.875rem;
            --text-4xl: 2.25rem;
            --text-5xl: 3rem;
            --text-6xl: 3.75rem;
            --text-7xl: 4.5rem;
            --text-8xl: 6rem;
            --text-9xl: 8rem;
            
            /* Advanced Animations */
            --duration-fast: 0.1s;
            --duration-normal: 0.2s;
            --duration-slow: 0.3s;
            --duration-slower: 0.5s;
            --duration-ultra: 0.8s;
            
            /* Premium Easing Functions */
            --ease-linear: linear;
            --ease-in: cubic-bezier(0.4, 0, 1, 1);
            --ease-out: cubic-bezier(0, 0, 0.2, 1);
            --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);
            --ease-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);
            --ease-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
            --ease-elastic: cubic-bezier(0.25, 0.46, 0.45, 0.94);
            
            /* Z-Index Scale */
            --z-dropdown: 1000;
            --z-sticky: 1020;
            --z-fixed: 1030;
            --z-modal-backdrop: 1040;
            --z-modal: 1050;
            --z-popover: 1060;
            --z-tooltip: 1070;
            --z-toast: 1080;
        }
        
        /* Dark Theme Variables */
        [data-theme="dark"] {
            --bg-primary: #000000;
            --bg-secondary: #1C1C1E;
            --bg-tertiary: #2C2C2E;
            --bg-quaternary: #3A3A3C;
            --bg-elevated: rgba(28, 28, 30, 0.9);
            --bg-overlay: rgba(0, 0, 0, 0.95);
            --bg-glass: rgba(0, 0, 0, 0.3);
            --bg-frosted: rgba(28, 28, 30, 0.85);
            --bg-card: #1C1C1E;
            --bg-input: #2C2C2E;
            --bg-sidebar: #1A1A1C;
            
            --text-primary: #F2F2F7;
            --text-secondary: rgba(235, 235, 245, 0.78);
            --text-tertiary: rgba(235, 235, 245, 0.56);
            --text-quaternary: rgba(235, 235, 245, 0.36);
            --text-inverse: #1D1D1F;
            
            --border-light: rgba(255, 255, 255, 0.1);
            --border-medium: rgba(255, 255, 255, 0.15);
            --border-strong: rgba(255, 255, 255, 0.2);
            
            --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.3);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.4), 0 1px 2px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -1px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.25);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.4), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.6);
            --shadow-ultra: 0 32px 64px -12px rgba(0, 0, 0, 0.6);
        }
        
        /* Revolutionary Base Styles */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        html {
            font-size: 16px;
            line-height: 1.6;
            scroll-behavior: smooth;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }
        
        body {
            font-family: var(--font-family);
            font-size: var(--text-base);
            font-weight: 400;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--bg-primary);
            overflow-x: hidden;
            transition: background-color var(--duration-normal) var(--ease-out),
                        color var(--duration-normal) var(--ease-out);
        }
        
        /* Ultra-Premium Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: transparent;
            border-radius: var(--radius-full);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--gradient-primary);
            border-radius: var(--radius-full);
            border: 2px solid transparent;
            background-clip: padding-box;
            transition: all var(--duration-normal) var(--ease-out);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--color-primary-dark), var(--color-secondary));
            background-clip: padding-box;
        }
        
        /* Premium Selection */
        ::selection {
            background: var(--gradient-primary);
            color: white;
            -webkit-text-fill-color: white;
        }
        
        /* Advanced Focus System */
        :focus {
            outline: none;
        }
        
        :focus-visible {
            outline: 2px solid var(--border-focus);
            outline-offset: 2px;
            border-radius: var(--radius-md);
        }
        
        /* Revolutionary Typography System */
        .text-display-2xl {
            font-size: var(--text-9xl);
            font-weight: 900;
            line-height: 1;
            letter-spacing: -0.05em;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .text-display-xl {
            font-size: var(--text-8xl);
            font-weight: 800;
            line-height: 1;
            letter-spacing: -0.04em;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .text-display-lg {
            font-size: var(--text-7xl);
            font-weight: 800;
            line-height: 1.1;
            letter-spacing: -0.03em;
        }
        
        .text-display {
            font-size: var(--text-6xl);
            font-weight: 700;
            line-height: 1.1;
            letter-spacing: -0.025em;
        }
        
        .text-headline {
            font-size: var(--text-5xl);
            font-weight: 700;
            line-height: 1.2;
            letter-spacing: -0.02em;
        }
        
        .text-title {
            font-size: var(--text-4xl);
            font-weight: 600;
            line-height: 1.25;
            letter-spacing: -0.015em;
        }
        
        .text-subtitle {
            font-size: var(--text-3xl);
            font-weight: 600;
            line-height: 1.3;
            letter-spacing: -0.01em;
        }
        
        .text-large {
            font-size: var(--text-2xl);
            font-weight: 500;
            line-height: 1.4;
        }
        
        .text-body {
            font-size: var(--text-base);
            font-weight: 400;
            line-height: 1.6;
        }
        
        .text-small {
            font-size: var(--text-sm);
            font-weight: 400;
            line-height: 1.5;
            color: var(--text-secondary);
        }
        
        .text-tiny {
            font-size: var(--text-xs);
            font-weight: 400;
            line-height: 1.4;
            color: var(--text-tertiary);
        }
        
        /* Revolutionary Layout System */
        .app {
            min-height: 100vh;
            background: var(--bg-primary);
            position: relative;
        }
        
        /* Ultra-Premium Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: var(--z-sticky);
            background: var(--bg-frosted);
            backdrop-filter: saturate(180%) blur(20px);
            -webkit-backdrop-filter: saturate(180%) blur(20px);
            border-bottom: 1px solid var(--border-light);
            transition: all var(--duration-normal) var(--ease-out);
        }
        
        .header.scrolled {
            background: var(--bg-overlay);
            box-shadow: var(--shadow-lg);
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1600px;
            margin: 0 auto;
            padding: var(--space-4) var(--space-6);
        }
        
        /* Revolutionary Brand */
        .brand {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            text-decoration: none;
            color: inherit;
            transition: transform var(--duration-normal) var(--ease-spring);
        }
        
        .brand:hover {
            transform: scale(1.02);
        }
        
        .brand-logo {
            width: 48px;
            height: 48px;
            background: var(--gradient-primary);
            border-radius: var(--radius-2xl);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-xl);
            font-weight: 800;
            color: white;
            box-shadow: var(--shadow-glow);
            position: relative;
            overflow: hidden;
        }
        
        .brand-logo::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.3) 50%, transparent 70%);
            transform: translateX(-100%);
            transition: transform var(--duration-normal) var(--ease-out);
        }
        
        .brand-logo:hover::before {
            transform: translateX(100%);
        }
        
        .brand-text {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }
        
        .brand-title {
            font-size: var(--text-xl);
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }
        
        .brand-subtitle {
            font-size: var(--text-sm);
            font-weight: 500;
            color: var(--text-tertiary);
            margin: 0;
        }
        
        /* Premium Header Controls */
        .header-controls {
            display: flex;
            align-items: center;
            gap: var(--space-6);
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-4);
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-full);
            font-size: var(--text-sm);
            font-weight: 500;
            transition: all var(--duration-normal) var(--ease-out);
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: var(--radius-full);
            background: var(--color-success);
            animation: pulse 2s infinite;
            box-shadow: 0 0 0 0 rgba(52, 199, 89, 0.7);
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(52, 199, 89, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(52, 199, 89, 0); }
            100% { box-shadow: 0 0 0 0 rgba(52, 199, 89, 0); }
        }
        
        /* Ultimate Button System */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-4);
            font-family: inherit;
            font-size: var(--text-base);
            font-weight: 600;
            line-height: 1;
            text-decoration: none;
            border: none;
            border-radius: var(--radius-xl);
            cursor: pointer;
            transition: all var(--duration-normal) var(--ease-spring);
            position: relative;
            overflow: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid var(--border-medium);
            box-shadow: var(--shadow-sm);
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left var(--duration-normal) var(--ease-out);
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn:active {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            border: 1px solid transparent;
            box-shadow: var(--shadow-glow);
        }
        
        .btn-success {
            background: var(--gradient-success);
            color: white;
            border: 1px solid transparent;
            box-shadow: 0 0 20px rgba(52, 199, 89, 0.3);
        }
        
        .btn-warning {
            background: var(--gradient-warning);
            color: white;
            border: 1px solid transparent;
            box-shadow: 0 0 20px rgba(255, 149, 0, 0.3);
        }
        
        .btn-error {
            background: var(--gradient-error);
            color: white;
            border: 1px solid transparent;
            box-shadow: 0 0 20px rgba(255, 59, 48, 0.3);
        }
        
        .btn-ghost {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border-light);
            box-shadow: none;
        }
        
        .btn-sm {
            padding: var(--space-2) var(--space-3);
            font-size: var(--text-sm);
            border-radius: var(--radius-lg);
        }
        
        .btn-lg {
            padding: var(--space-4) var(--space-6);
            font-size: var(--text-lg);
            border-radius: var(--radius-2xl);
        }
        
        .btn-icon {
            width: 44px;
            height: 44px;
            padding: 0;
            border-radius: var(--radius-full);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        /* Revolutionary Search Section */
        .hero-section {
            padding: calc(80px + var(--space-20)) var(--space-6) var(--space-20);
            background: var(--gradient-mesh), var(--bg-secondary);
            position: relative;
            overflow: hidden;
        }
        
        .hero-section::before {
            content: '';
            position: absolute;
            inset: 0;
            background: var(--gradient-mesh);
            opacity: 0.8;
            animation: float 10s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(2deg); }
        }
        
        .hero-container {
            max-width: 1000px;
            margin: 0 auto;
            text-align: center;
            position: relative;
            z-index: 1;
        }
        
        .hero-header {
            margin-bottom: var(--space-12);
        }
        
        .hero-title {
            font-size: clamp(var(--text-5xl), 8vw, var(--text-7xl));
            font-weight: 800;
            line-height: 1.1;
            margin-bottom: var(--space-6);
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: slideInUp 1s var(--ease-spring);
        }
        
        .hero-description {
            font-size: var(--text-xl);
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto var(--space-8);
            animation: slideInUp 1s var(--ease-spring) 0.1s both;
        }
        
        .hero-stats {
            display: flex;
            justify-content: center;
            gap: var(--space-8);
            margin-bottom: var(--space-12);
            animation: slideInUp 1s var(--ease-spring) 0.2s both;
        }
        
        .hero-stat {
            text-align: center;
        }
        
        .hero-stat-number {
            font-size: var(--text-3xl);
            font-weight: 800;
            color: var(--color-primary);
            display: block;
        }
        
        .hero-stat-label {
            font-size: var(--text-sm);
            color: var(--text-tertiary);
            font-weight: 500;
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Premium Search Form */
        .search-form {
            display: flex;
            flex-direction: column;
            gap: var(--space-8);
            margin-bottom: var(--space-10);
            animation: slideInUp 1s var(--ease-spring) 0.3s both;
        }
        
        .search-input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-6);
            align-items: end;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
            text-align: left;
        }
        
        .input-label {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .input {
            width: 100%;
            padding: var(--space-4) var(--space-5);
            font-family: inherit;
            font-size: var(--text-base);
            font-weight: 400;
            line-height: 1.5;
            color: var(--text-primary);
            background: var(--bg-input);
            border: 2px solid var(--border-light);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-sm);
            transition: all var(--duration-normal) var(--ease-out);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }
        
        .input:focus {
            border-color: var(--border-focus);
            box-shadow: var(--shadow-focus), var(--shadow-glow);
            transform: translateY(-2px);
        }
        
        .input::placeholder {
            color: var(--text-tertiary);
        }
        
        .textarea {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }
        
        /* Revolutionary Action Bar */
        .action-bar {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--space-4);
            flex-wrap: wrap;
        }
        
        .progress-container {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            min-width: 200px;
        }
        
        .progress-bar {
            flex: 1;
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-full);
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: var(--radius-full);
            transition: width var(--duration-slow) var(--ease-out);
            position: relative;
            width: 0%;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 1.5s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .progress-text {
            font-size: var(--text-sm);
            color: var(--text-tertiary);
            font-weight: 500;
            min-width: 60px;
        }
        
        /* Ultra-Premium Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 360px 1fr 400px;
            gap: var(--space-8);
            padding: var(--space-10) var(--space-6);
            max-width: 1800px;
            margin: 0 auto;
            min-height: 80vh;
        }
        
        /* Revolutionary Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: var(--space-6);
        }
        
        .sidebar-card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-3xl);
            padding: var(--space-6);
            box-shadow: var(--shadow-md);
            transition: all var(--duration-normal) var(--ease-out);
        }
        
        .sidebar-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }
        
        .sidebar-title {
            font-size: var(--text-lg);
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--space-5);
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }
        
        .select {
            appearance: none;
            width: 100%;
            padding: var(--space-3) var(--space-8) var(--space-3) var(--space-4);
            font-family: inherit;
            font-size: var(--text-base);
            font-weight: 500;
            line-height: 1.5;
            color: var(--text-primary);
            background: var(--bg-input);
            border: 2px solid var(--border-light);
            border-radius: var(--radius-xl);
            cursor: pointer;
            transition: all var(--duration-normal) var(--ease-out);
            background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236B7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
            background-position: right var(--space-3) center;
            background-repeat: no-repeat;
            background-size: 16px;
        }
        
        .select:focus {
            border-color: var(--border-focus);
            box-shadow: var(--shadow-focus);
        }
        
        /* Premium Toggle Switch */
        .switch {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            cursor: pointer;
            user-select: none;
        }
        
        .switch-input {
            display: none;
        }
        
        .switch-slider {
            position: relative;
            width: 52px;
            height: 32px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-full);
            transition: all var(--duration-normal) var(--ease-out);
        }
        
        .switch-slider::before {
            content: '';
            position: absolute;
            top: 4px;
            left: 4px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: var(--radius-full);
            transition: all var(--duration-normal) var(--ease-spring);
            box-shadow: var(--shadow-sm);
        }
        
        .switch-input:checked + .switch-slider {
            background: var(--gradient-primary);
        }
        
        .switch-input:checked + .switch-slider::before {
            transform: translateX(20px);
        }
        
        .switch-label {
            font-size: var(--text-base);
            font-weight: 500;
            color: var(--text-primary);
        }
        
        /* Revolutionary Results Panel */
        .results-panel {
            display: flex;
            flex-direction: column;
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-3xl);
            box-shadow: var(--shadow-xl);
            overflow: hidden;
            min-height: 700px;
        }
        
        .results-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-6);
            background: var(--bg-frosted);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-light);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .results-title {
            font-size: var(--text-xl);
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .results-actions {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            flex-wrap: wrap;
        }
        
        .results-content {
            flex: 1;
            overflow: auto;
            padding: var(--space-4);
        }
        
        /* Premium Table */
        .table-container {
            overflow-x: auto;
            border-radius: var(--radius-2xl);
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            border-spacing: 0;
        }
        
        .table th {
            padding: var(--space-4) var(--space-5);
            font-size: var(--text-sm);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--border-light);
            text-align: left;
            position: sticky;
            top: 0;
            z-index: 5;
        }
        
        .table td {
            padding: var(--space-4) var(--space-5);
            border-bottom: 1px solid var(--border-light);
            vertical-align: middle;
            transition: all var(--duration-fast) var(--ease-out);
        }
        
        .table tr {
            transition: all var(--duration-fast) var(--ease-out);
        }
        
        .table tbody tr:hover {
            background: var(--bg-secondary);
            transform: scale(1.01);
            box-shadow: var(--shadow-sm);
        }
        
        .table tbody tr.selected {
            background: rgba(0, 122, 255, 0.1);
            border-left: 4px solid var(--color-primary);
        }
        
        /* Channel Display */
        .channel-info {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }
        
        .channel-avatar {
            width: 56px;
            height: 56px;
            border-radius: var(--radius-2xl);
            object-fit: cover;
            box-shadow: var(--shadow-sm);
            transition: all var(--duration-normal) var(--ease-out);
        }
        
        .channel-avatar:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-lg);
        }
        
        .channel-details h4 {
            font-size: var(--text-base);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--space-1);
            line-height: 1.4;
        }
        
        .channel-details p {
            font-size: var(--text-sm);
            color: var(--text-tertiary);
            font-family: var(--font-mono);
            margin: 0;
        }
        
        /* Premium Badge */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            padding: var(--space-1) var(--space-3);
            font-size: var(--text-xs);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-radius: var(--radius-full);
            transition: all var(--duration-normal) var(--ease-out);
        }
        
        .badge-verified {
            background: var(--gradient-success);
            color: white;
            box-shadow: 0 4px 12px rgba(52, 199, 89, 0.3);
        }
        
        .badge-premium {
            background: var(--gradient-warning);
            color: white;
            box-shadow: 0 4px 12px rgba(255, 149, 0, 0.3);
        }
        
        .badge-ai {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-glow);
        }
        
        /* Ultra-Premium Details Panel */
        .details-panel {
            display: flex;
            flex-direction: column;
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-3xl);
            box-shadow: var(--shadow-xl);
            overflow: hidden;
        }
        
        .details-header {
            padding: var(--space-6);
            background: var(--bg-frosted);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-light);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .details-content {
            flex: 1;
            padding: var(--space-6);
            overflow: auto;
        }
        
        /* Premium Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: var(--space-4);
            margin: var(--space-6) 0;
        }
        
        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-2xl);
            padding: var(--space-5);
            text-align: center;
            transition: all var(--duration-normal) var(--ease-out);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }
        
        .stat-value {
            font-size: var(--text-3xl);
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: var(--space-2);
        }
        
        .stat-label {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        /* Revolutionary Modal System */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: var(--z-modal);
            opacity: 0;
            transition: opacity var(--duration-normal) var(--ease-out);
        }
        
        .modal-overlay.show {
            opacity: 1;
        }
        
        .modal {
            background: var(--bg-card);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-3xl);
            box-shadow: var(--shadow-ultra);
            padding: var(--space-8);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            transform: scale(0.95) translateY(20px);
            transition: all var(--duration-normal) var(--ease-spring);
        }
        
        .modal-overlay.show .modal {
            transform: scale(1) translateY(0);
        }
        
        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-6);
        }
        
        .modal-title {
            font-size: var(--text-2xl);
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .modal-close {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-secondary);
            border: none;
            border-radius: var(--radius-full);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: var(--text-xl);
            transition: all var(--duration-normal) var(--ease-out);
        }
        
        .modal-close:hover {
            background: var(--bg-tertiary);
            transform: scale(1.1);
        }
        
        .modal-content {
            margin-bottom: var(--space-6);
            line-height: 1.7;
            color: var(--text-secondary);
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: var(--space-4);
        }
        
        /* Premium Toast System */
        .toast {
            position: fixed;
            top: var(--space-6);
            right: var(--space-6);
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-xl);
            padding: var(--space-4) var(--space-5);
            max-width: 400px;
            z-index: var(--z-toast);
            transform: translateX(120%);
            transition: transform var(--duration-normal) var(--ease-spring);
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast-content {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }
        
        .toast-icon {
            width: 24px;
            height: 24px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-sm);
            flex-shrink: 0;
        }
        
        .toast-message {
            font-size: var(--text-sm);
            font-weight: 500;
            color: var(--text-primary);
            line-height: 1.5;
        }
        
        .toast.success {
            border-left: 4px solid var(--color-success);
        }
        
        .toast.success .toast-icon {
            background: var(--color-success);
            color: white;
        }
        
        .toast.error {
            border-left: 4px solid var(--color-error);
        }
        
        .toast.error .toast-icon {
            background: var(--color-error);
            color: white;
        }
        
        .toast.info {
            border-left: 4px solid var(--color-info);
        }
        
        .toast.info .toast-icon {
            background: var(--color-info);
            color: white;
        }
        
        .toast.warning {
            border-left: 4px solid var(--color-warning);
        }
        
        .toast.warning .toast-icon {
            background: var(--color-warning);
            color: white;
        }
        
        /* Revolutionary Empty State */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: var(--space-16);
            text-align: center;
        }
        
        .empty-state-icon {
            width: 120px;
            height: 120px;
            margin-bottom: var(--space-8);
            background: var(--bg-secondary);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-6xl);
            color: var(--text-tertiary);
            animation: float 6s ease-in-out infinite;
        }
        
        .empty-state-title {
            font-size: var(--text-2xl);
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--space-4);
        }
        
        .empty-state-description {
            font-size: var(--text-lg);
            color: var(--text-secondary);
            max-width: 400px;
            line-height: 1.6;
        }
        
        /* Premium Loading States */
        .skeleton {
            background: linear-gradient(90deg, var(--bg-secondary) 25%, var(--bg-tertiary) 50%, var(--bg-secondary) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: var(--radius-lg);
        }
        
        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .skeleton-text {
            height: 1em;
            margin-bottom: 0.5em;
        }
        
        .skeleton-text:last-child {
            width: 75%;
            margin-bottom: 0;
        }
        
        .skeleton-avatar {
            width: 56px;
            height: 56px;
            border-radius: var(--radius-2xl);
        }
        
        .skeleton-card {
            height: 200px;
            border-radius: var(--radius-2xl);
        }
        
        /* Ultra-Premium Authentication */
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gradient-mesh), var(--bg-secondary);
            padding: var(--space-6);
            position: relative;
        }
        
        .auth-card {
            background: var(--bg-card);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-4xl);
            box-shadow: var(--shadow-ultra);
            padding: var(--space-12);
            width: 100%;
            max-width: 480px;
            text-align: center;
            animation: slideInUp 1s var(--ease-spring);
        }
        
        .auth-header {
            margin-bottom: var(--space-10);
        }
        
        .auth-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto var(--space-6);
            background: var(--gradient-primary);
            border-radius: var(--radius-3xl);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-4xl);
            font-weight: 800;
            color: white;
            box-shadow: var(--shadow-glow);
            animation: float 6s ease-in-out infinite;
        }
        
        .auth-title {
            font-size: var(--text-3xl);
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: var(--space-4);
        }
        
        .auth-description {
            font-size: var(--text-lg);
            color: var(--text-secondary);
            margin-bottom: var(--space-8);
        }
        
        .auth-form {
            display: flex;
            flex-direction: column;
            gap: var(--space-5);
            text-align: left;
        }
        
        /* Premium Loading Spinner */
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: var(--radius-full);
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Utility Classes */
        .hidden { display: none !important; }
        .flex { display: flex; }
        .grid { display: grid; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .text-center { text-align: center; }
        .font-bold { font-weight: 700; }
        .font-semibold { font-weight: 600; }
        .font-medium { font-weight: 500; }
        .uppercase { text-transform: uppercase; }
        .truncate {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        /* Responsive Design */
        @media (max-width: 1400px) {
            .main-content {
                grid-template-columns: 320px 1fr 360px;
                gap: var(--space-6);
            }
        }
        
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto;
                gap: var(--space-6);
            }
            
            .search-input-group {
                grid-template-columns: 1fr;
            }
            
            .hero-stats {
                flex-direction: column;
                gap: var(--space-4);
            }
        }
        
        @media (max-width: 768px) {
            .header-content {
                padding: var(--space-3) var(--space-4);
            }
            
            .hero-section {
                padding: calc(60px + var(--space-12)) var(--space-4) var(--space-12);
            }
            
            .main-content {
                padding: var(--space-8) var(--space-4);
            }
            
            .auth-card {
                padding: var(--space-8);
            }
            
            .results-header {
                flex-direction: column;
                gap: var(--space-4);
                align-items: stretch;
            }
            
            .results-actions {
                justify-content: center;
            }
            
            .action-bar {
                flex-direction: column;
            }
        }
        
        @media (max-width: 480px) {
            .brand-text {
                display: none;
            }
            
            .header-controls {
                gap: var(--space-3);
            }
            
            .hero-title {
                font-size: var(--text-4xl);
            }
            
            .hero-description {
                font-size: var(--text-lg);
            }
        }
        
        /* Print Styles */
        @media print {
            .header,
            .sidebar,
            .details-panel,
            .modal-overlay,
            .toast,
            .btn {
                display: none !important;
            }
            
            .main-content {
                grid-template-columns: 1fr;
                padding: 0;
            }
            
            .results-panel {
                box-shadow: none;
                border: none;
            }
        }
        
        /* High Contrast Mode */
        @media (prefers-contrast: high) {
            :root {
                --border-light: rgba(0, 0, 0, 0.3);
                --border-medium: rgba(0, 0, 0, 0.5);
                --border-strong: rgba(0, 0, 0, 0.7);
            }
            
            [data-theme="dark"] {
                --border-light: rgba(255, 255, 255, 0.3);
                --border-medium: rgba(255, 255, 255, 0.5);
                --border-strong: rgba(255, 255, 255, 0.7);
            }
        }
        
        /* Reduced Motion */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>

<body>
    <!-- Revolutionary Authentication System -->
    <div id="authView" class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <div class="auth-logo">LS</div>
                <h1 class="auth-title">Welcome to Lead Studio Pro</h1>
                <p class="auth-description">Revolutionary YouTube Channel Discovery Platform powered by Advanced AI</p>
            </div>
            <form class="auth-form" id="authForm">
                <div class="input-group">
                    <label class="input-label" for="authEmail">Email Address</label>
                    <input id="authEmail" class="input" type="email" placeholder="Enter your email address" 
                           autocomplete="username" required>
                </div>
                <div class="input-group">
                    <label class="input-label" for="authPassword">Password</label>
                    <input id="authPassword" class="input" type="password" placeholder="Enter your password" 
                           autocomplete="current-password" required>
                </div>
                <button type="button" class="btn btn-primary btn-lg" id="btnSignIn">
                    <span>Sign In</span>
                </button>
                <button type="button" class="btn btn-lg" id="btnSignUp">
                    <span>Create Account</span>
                </button>
                <div id="authStatus" class="hidden"></div>
            </form>
        </div>
    </div>

    <!-- Ultra-Premium Application Interface -->
    <div id="appView" class="app hidden">
        <!-- Revolutionary Header -->
        <header class="header" id="mainHeader">
            <div class="header-content">
                <a href="#" class="brand">
                    <div class="brand-logo">LS</div>
                    <div class="brand-text">
                        <h1 class="brand-title">Lead Studio Pro</h1>
                        <p class="brand-subtitle">Next Generation Discovery</p>
                    </div>
                </a>
                
                <div class="header-controls">
                    <div class="status-indicator" id="statusIndicator">
                        <div class="status-dot"></div>
                        <span id="statusText">Ready</span>
                    </div>
                    
                    <button class="btn btn-icon btn-ghost" id="themeToggle" title="Toggle Theme">
                        <span id="themeIcon">🌙</span>
                    </button>
                    
                    <div id="userInfo" class="text-small"></div>
                    
                    <button class="btn btn-sm" id="btnSignOut">
                        Sign Out
                    </button>
                </div>
            </div>
        </header>

        <!-- Revolutionary Hero Section -->
        <section class="hero-section">
            <div class="hero-container">
                <div class="hero-header">
                    <h1 class="hero-title">Discover YouTube Channels Like Never Before</h1>
                    <p class="hero-description">
                        Harness the power of Advanced AI to discover high-quality YouTube channels 
                        with unprecedented precision and intelligence.
                    </p>
                    
                    <div class="hero-stats">
                        <div class="hero-stat">
                            <span class="hero-stat-number" id="totalChannels">1M+</span>
                            <span class="hero-stat-label">Channels Analyzed</span>
                        </div>
                        <div class="hero-stat">
                            <span class="hero-stat-number" id="totalSearches">50K+</span>
                            <span class="hero-stat-label">Searches Performed</span>
                        </div>
                        <div class="hero-stat">
                            <span class="hero-stat-number">99.9%</span>
                            <span class="hero-stat-label">Accuracy Rate</span>
                        </div>
                    </div>
                </div>
                
                <div class="search-form">
                    <div class="search-input-group">
                        <div class="input-group">
                            <label class="input-label" for="apiKey">YouTube API Key</label>
                            <input id="apiKey" class="input" type="text" 
                                   placeholder="Enter your YouTube API key"
                                   value="AIzaSyBo5wWMC5T5lemycWNqtfs2_SAjApsLuFA">
                        </div>
                        <div class="input-group">
                            <label class="input-label" for="searchQuery">Search Queries</label>
                            <textarea id="searchQuery" class="input textarea" 
                                      placeholder="Enter search queries (comma or newline separated)

Examples:
• tech reviews, gadget unboxings  
• fitness motivation, workout tutorials
• cooking recipes, food reviews
• business tips, entrepreneurship"></textarea>
                        </div>
                    </div>
                    
                    <div class="action-bar">
                        <button class="btn btn-primary btn-lg" id="btnSmartSearch">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="M21 21l-4.35-4.35"/>
                            </svg>
                            <span>Smart Search</span>
                        </button>
                        
                        <button class="btn btn-success btn-lg" id="btnAISearch">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                            </svg>
                            <span>AI Deep Search</span>
                            <div class="badge badge-ai">AI</div>
                        </button>
                        
                        <button class="btn btn-ghost" id="btnClear">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"/>
                                <line x1="6" y1="6" x2="18" y2="18"/>
                            </svg>
                            <span>Clear</span>
                        </button>
                        
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                            <span class="progress-text" id="progressText">Ready</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Ultra-Premium Main Content -->
        <main class="main-content">
            <!-- Revolutionary Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-card">
                    <h3 class="sidebar-title">🎯 Search Filters</h3>
                    <div class="filter-group">
                        <div class="input-group">
                            <label class="input-label" for="orderBy">Order By</label>
                            <select id="orderBy" class="select">
                                <option value="relevance">Relevance</option>
                                <option value="date">Date</option>
                                <option value="viewCount">View Count</option>
                                <option value="rating">Rating</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label" for="duration">Duration</label>
                            <select id="duration" class="select">
                                <option value="">Any Duration</option>
                                <option value="short">Short (&lt;4min)</option>
                                <option value="medium">Medium (4–20min)</option>
                                <option value="long">Long (&gt;20min)</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label" for="uploadTime">Upload Time</label>
                            <select id="uploadTime" class="select">
                                <option value="">Any Time</option>
                                <option value="hour">Last Hour</option>
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label" for="region">Region</label>
                            <select id="region" class="select">
                                <option value="">Any Region</option>
                                <option value="US">🇺🇸 United States</option>
                                <option value="IN">🇮🇳 India</option>
                                <option value="GB">🇬🇧 United Kingdom</option>
                                <option value="CA">🇨🇦 Canada</option>
                                <option value="AU">🇦🇺 Australia</option>
                                <option value="DE">🇩🇪 Germany</option>
                                <option value="FR">🇫🇷 France</option>
                                <option value="JP">🇯🇵 Japan</option>
                                <option value="BR">🇧🇷 Brazil</option>
                                <option value="MX">🇲🇽 Mexico</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="sidebar-card">
                    <h3 class="sidebar-title">🎛️ Channel Filters</h3>
                    <div class="filter-group">
                        <div class="input-group">
                            <label class="input-label" for="subscriberRange">Subscriber Range</label>
                            <div class="flex" style="gap: var(--space-3);">
                                <input id="minSubs" class="input" type="number" placeholder="Min" min="0" step="1000">
                                <input id="maxSubs" class="input" type="number" placeholder="Max" min="0" step="1000">
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label" for="resultsPerPage">Results per Page</label>
                            <input id="resultsPerPage" class="input" type="number" min="1" max="50" value="25">
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label" for="pagesPerQuery">Pages per Query</label>
                            <input id="pagesPerQuery" class="input" type="number" min="1" max="20" value="3">
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label" for="searchInResults">Search in Results</label>
                            <input id="searchInResults" class="input" type="text" 
                                   placeholder="🔍 Filter results...">
                        </div>
                    </div>
                </div>
                
                <div class="sidebar-card">
                    <h3 class="sidebar-title">⚙️ Advanced Options</h3>
                    <div class="filter-group">
                        <div class="input-group">
                            <label class="input-label" for="corsProxy">CORS Proxy URL</label>
                            <input id="corsProxy" class="input" type="url" 
                                   placeholder="Optional proxy URL for social links">
                        </div>
                        
                        <label class="switch">
                            <input id="enableAIAnalysis" class="switch-input" type="checkbox" checked>
                            <div class="switch-slider"></div>
                            <span class="switch-label">AI Quality Analysis</span>
                        </label>
                        
                        <label class="switch">
                            <input id="enableSocialLinks" class="switch-input" type="checkbox">
                            <div class="switch-slider"></div>
                            <span class="switch-label">Extract Social Links</span>
                        </label>
                        
                        <label class="switch">
                            <input id="enableGrowthPrediction" class="switch-input" type="checkbox">
                            <div class="switch-slider"></div>
                            <span class="switch-label">Growth Prediction</span>
                        </label>
                    </div>
                </div>
                
                <div class="sidebar-card">
                    <h3 class="sidebar-title">💾 Library Management</h3>
                    <div class="filter-group">
                        <button class="btn btn-primary" id="btnSaveLibrary">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                <polyline points="17,21 17,13 7,13 7,21"/>
                                <polyline points="7,3 7,8 15,8"/>
                            </svg>
                            <span>Save Library</span>
                        </button>
                        
                        <button class="btn" id="btnLoadLibrary">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14,2 14,8 20,8"/>
                                <line x1="16" y1="13" x2="8" y2="13"/>
                                <line x1="16" y1="17" x2="8" y2="17"/>
                            </svg>
                            <span>Load Library</span>
                        </button>
                    </div>
                </div>
            </aside>

            <!-- Revolutionary Results Panel -->
            <section class="results-panel">
                <div class="results-header">
                    <h2 class="results-title" id="resultsTitle">🚀 Discovery Results</h2>
                    <div class="results-actions">
                        <select id="sortBy" class="select" style="width: auto;">
                            <option value="quality-desc">🏆 Quality Score ↓</option>
                            <option value="subs-desc">👥 Subscribers ↓</option>
                            <option value="subs-asc">👥 Subscribers ↑</option>
                            <option value="views-desc">👁️ Views ↓</option>
                            <option value="views-asc">👁️ Views ↑</option>
                            <option value="engagement-desc">📈 Engagement ↓</option>
                            <option value="growth-desc">🚀 Growth ↓</option>
                            <option value="title-asc">🔤 Title A→Z</option>
                            <option value="title-desc">🔤 Title Z→A</option>
                        </select>
                        
                        <button class="btn btn-sm" id="btnSelectAll">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9,11 12,14 22,4"/>
                                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                            </svg>
                            Select All
                        </button>
                        
                        <button class="btn btn-sm" id="btnDeselectAll">Clear</button>
                        
                        <button class="btn btn-primary btn-sm" id="btnExportCSV">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="7,10 12,15 17,10"/>
                                <line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                            Export CSV
                        </button>
                        
                        <button class="btn btn-sm" id="btnExportJSON">JSON</button>
                        <button class="btn btn-sm" id="btnCopyIDs">Copy IDs</button>
                        
                        <button class="btn btn-error btn-sm" id="btnClearResults">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="3,6 5,6 21,6"/>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                            </svg>
                            Clear All
                        </button>
                    </div>
                </div>
                
                <div class="results-content">
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th style="width: 50px;"></th>
                                    <th>Channel</th>
                                    <th style="width: 120px;">Subscribers</th>
                                    <th style="width: 80px;">Videos</th>
                                    <th style="width: 120px;">Views</th>
                                    <th style="width: 100px;">Quality</th>
                                    <th style="width: 80px;">Status</th>
                                    <th style="width: 100px;">Country</th>
                                </tr>
                            </thead>
                            <tbody id="resultsTableBody">
                                <tr>
                                    <td colspan="8">
                                        <div class="empty-state">
                                            <div class="empty-state-icon">🚀</div>
                                            <div class="empty-state-title">Ready to Discover</div>
                                            <div class="empty-state-description">
                                                Enter your search terms above and click "Smart Search" to discover 
                                                amazing YouTube channels powered by Advanced AI.
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Ultra-Premium Details Panel -->
            <aside class="details-panel">
                <div class="details-header">
                    <h3 class="text-title" id="detailsTitle">📊 Channel Analytics</h3>
                    <div class="flex" style="gap: var(--space-3);">
                        <button class="btn btn-sm" id="btnExportSelected">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="7,10 12,15 17,10"/>
                                <line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                            Export
                        </button>
                        <button class="btn btn-sm" id="btnCopySelected">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                            </svg>
                            Copy
                        </button>
                    </div>
                </div>
                
                <div class="details-content" id="detailsContent">
                    <div class="empty-state">
                        <div class="empty-state-icon">👆</div>
                        <div class="empty-state-title">Select a Channel</div>
                        <div class="empty-state-description">
                            Click on any channel from the results table to view detailed 
                            analytics and AI-powered insights.
                        </div>
                    </div>
                </div>
            </aside>
        </main>
    </div>

    <!-- Revolutionary Modal System -->
    <div id="modalOverlay" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Confirmation</h3>
                <button class="modal-close" id="modalClose" aria-label="Close">×</button>
            </div>
            <div class="modal-content">
                <p id="modalMessage">Are you sure you want to proceed?</p>
            </div>
            <div class="modal-actions">
                <button class="btn" id="modalCancel">Cancel</button>
                <button class="btn btn-primary" id="modalConfirm">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Premium Toast System -->
    <div id="toast" class="toast">
        <div class="toast-content">
            <div class="toast-icon" id="toastIcon">ℹ️</div>
            <div class="toast-message" id="toastMessage">Notification message</div>
        </div>
    </div>
<script type="module">
/* ==========================================
   REVOLUTIONARY JAVASCRIPT ENGINE - NEXT GENERATION
   ========================================== */

// Import Firebase modules
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, updateDoc, increment, Timestamp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";
import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-functions.js";
import { getAnalytics, logEvent } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-analytics.js";

/* ==========================================
   REVOLUTIONARY STATE MANAGEMENT
   ========================================== */

const $ = id => document.getElementById(id);
const $$ = selector => document.querySelectorAll(selector);
const sleep = ms => new Promise(resolve => setTimeout(resolve, ms));
const debounce = (func, wait) => {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
};

// Advanced State Management
class StateManager {
    constructor() {
        this.state = {
            user: null,
            channels: [],
            filteredChannels: [],
            selectedChannels: new Set(),
            searchHistory: [],
            analytics: new Map(),
            cache: new Map(),
            settings: {
                theme: 'light',
                aiAnalysis: true,
                socialLinks: false,
                growthPrediction: false,
                autoSave: true
            }
        };
        this.listeners = new Map();
    }

    setState(key, value) {
        this.state[key] = value;
        this.notify(key, value);
    }

    getState(key) {
        return this.state[key];
    }

    subscribe(key, callback) {
        if (!this.listeners.has(key)) {
            this.listeners.set(key, []);
        }
        this.listeners.get(key).push(callback);
    }

    notify(key, value) {
        if (this.listeners.has(key)) {
            this.listeners.get(key).forEach(callback => callback(value));
        }
    }
}

const stateManager = new StateManager();

// Advanced Configuration
const CONFIG = {
    LIBRARY_KEY: 'lead_studio_pro_next_gen_v1',
    MAX_CACHE_SIZE: 100,
    MAX_SEARCH_HISTORY: 50,
    BATCH_SIZE: 50,
    RATE_LIMIT_DELAY: 250,
    API_TIMEOUT: 30000,
    MAX_RETRIES: 3,
    SEARCH_DEBOUNCE: 300,
    ANALYTICS_UPDATE_INTERVAL: 5000
};

// Advanced Utilities
const Utils = {
    sanitize: (str) => {
        if (!str) return '';
        return String(str)
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#x27;')
            .replace(/\//g, '&#x2F;');
    },

    formatNumber: (num) => {
        if (!num || num === 0) return '0';
        if (num >= 1000000000) return (num / 1000000000).toFixed(1) + 'B';
        if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
        if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
        return num.toLocaleString();
    },

    generateId: () => {
        return Math.random().toString(36).substr(2, 9) + Date.now().toString(36);
    },

    deepClone: (obj) => {
        return JSON.parse(JSON.stringify(obj));
    },

    copyToClipboard: async (text) => {
        try {
            await navigator.clipboard.writeText(text);
            return true;
        } catch (err) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            const success = document.execCommand('copy');
            document.body.removeChild(textarea);
            return success;
        }
    },

    downloadFile: (content, filename, mimeType) => {
        const blob = new Blob([content], { type: mimeType });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = filename;
        link.style.display = 'none';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
    },

    parseCSV: (str) => {
        const result = [];
        let current = '';
        let inQuotes = false;
        for (let i = 0; i < str.length; i++) {
            const char = str[i];
            if (char === '"') {
                inQuotes = !inQuotes;
            } else if (char === ',' && !inQuotes) {
                result.push(current.trim());
                current = '';
            } else {
                current += char;
            }
        }
        result.push(current.trim());
        return result.filter(Boolean);
    },

    generateCSV: (channels) => {
        const headers = [
            'Channel Name',
            'Channel ID', 
            'Subscribers',
            'Total Views',
            'Video Count',
            'Country',
            'Verified',
            'Quality Score',
            'Engagement Rate',
            'Growth Potential',
            'Created Date',
            'Description',
            'Avatar URL',
            'Banner URL',
            'Social Links',
            'Topics',
            'Language',
            'Upload Frequency'
        ];
        
        const escape = (field) => {
            if (field === null || field === undefined) return '';
            const str = String(field);
            if (str.includes(',') || str.includes('"') || str.includes('\n')) {
                return `"${str.replace(/"/g, '""')}"`;
            }
            return str;
        };
        
        const rows = channels.map(channel => [
            escape(channel.title),
            escape(channel.channelId),
            escape(channel.subs),
            escape(channel.views),
            escape(channel.videos),
            escape(channel.country),
            escape(channel.verified),
            escape(channel.qualityScore || 0),
            escape(channel.engagementRate || 0),
            escape(channel.growthPotential || 'Unknown'),
            escape(channel.createdAt),
            escape(channel.description),
            escape(channel.avatar),
            escape(channel.banner),
            escape(channel.socialLinks ? Object.values(channel.socialLinks).join('; ') : ''),
            escape(channel.topics ? channel.topics.join('; ') : ''),
            escape(channel.language || ''),
            escape(channel.uploadFrequency || '')
        ]);
        
        return [headers.join(','), ...rows.map(row => row.join(','))].join('\n');
    }
};

/* ==========================================
   FIREBASE CONFIGURATION
   ========================================== */

const firebaseConfig = {
    apiKey: "AIzaSyBvU3_Njbi1JQr_wD1a16h5coTW2ifaRDU",
    authDomain: "youleadmax.firebaseapp.com",
    projectId: "youleadmax",
    storageBucket: "youleadmax.firebasestorage.app",
    messagingSenderId: "710806971072",
    appId: "1:710806971072:web:ced903befe8693f886c325",
    measurementId: "G-JW9W20C1LQ"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const functions = getFunctions(app);
const analytics = getAnalytics(app);

// Cloud Functions
const cloudFunctions = {
    logSearch: httpsCallable(functions, 'logSearch'),
    analyzeChannel: httpsCallable(functions, 'analyzeChannel'),
    predictGrowth: httpsCallable(functions, 'predictGrowth'),
    extractSocialLinks: httpsCallable(functions, 'extractSocialLinks')
};

/* ==========================================
   REVOLUTIONARY UI SYSTEM
   ========================================== */

class UIManager {
    constructor() {
        this.theme = localStorage.getItem('theme') || 'light';
        this.setupEventListeners();
        this.initializeTheme();
    }

    setupEventListeners() {
        // Theme toggle
        $('themeToggle').addEventListener('click', () => this.toggleTheme());
        
        // Header scroll effect
        window.addEventListener('scroll', debounce(() => {
            const header = $('mainHeader');
            if (window.scrollY > 100) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        }, 10));
        
        // Modal close handlers
        $('modalClose').addEventListener('click', () => this.hideModal());
        $('modalCancel').addEventListener('click', () => this.hideModal());
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => this.handleKeyboard(e));
        
        // Search input handlers
        $('searchInResults').addEventListener('input', debounce((e) => {
            searchEngine.applyFilters();
        }, CONFIG.SEARCH_DEBOUNCE));
    }

    initializeTheme() {
        document.documentElement.setAttribute('data-theme', this.theme);
        this.updateThemeIcon();
    }

    toggleTheme() {
        this.theme = this.theme === 'light' ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', this.theme);
        localStorage.setItem('theme', this.theme);
        this.updateThemeIcon();
        
        // Smooth transition
        const toggle = $('themeToggle');
        toggle.style.transform = 'scale(0.9)';
        setTimeout(() => {
            toggle.style.transform = '';
        }, 150);
        
        this.showToast(`Switched to ${this.theme} mode`, 'success');
        
        // Log theme change
        logEvent(analytics, 'theme_changed', { theme: this.theme });
    }

    updateThemeIcon() {
        $('themeIcon').textContent = this.theme === 'dark' ? '☀️' : '🌙';
    }

    handleKeyboard(e) {
        // Cmd/Ctrl + K for search focus
        if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
            e.preventDefault();
            $('searchQuery').focus();
            return;
        }
        
        // Cmd/Ctrl + Enter for search
        if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') {
            e.preventDefault();
            if ($('searchQuery').value.trim()) {
                searchEngine.performSearch(false);
            }
            return;
        }
        
        // Escape for clearing/closing
        if (e.key === 'Escape') {
            if ($('modalOverlay').classList.contains('show')) {
                this.hideModal();
            } else if ($('searchQuery').value.trim()) {
                $('searchQuery').value = '';
                searchEngine.reset();
            }
            return;
        }
    }

    setStatus(text, type = 'idle') {
        const statusText = $('statusText');
        const progressText = $('progressText');
        const statusIndicator = $('statusIndicator');
        
        statusText.textContent = text;
        progressText.textContent = text;
        
        // Update status indicator
        statusIndicator.className = `status-indicator status-${type}`;
        
        // Update status dot color and animation
        const dot = statusIndicator.querySelector('.status-dot');
        if (dot) {
            dot.style.background = this.getStatusColor(type);
            
            if (type === 'loading') {
                dot.style.animation = 'pulse 1s infinite';
            } else {
                dot.style.animation = type === 'success' ? 'pulse 2s infinite' : '';
            }
        }
    }

    getStatusColor(type) {
        const colors = {
            idle: 'var(--color-success)',
            loading: 'var(--color-primary)',
            success: 'var(--color-success)',
            error: 'var(--color-error)',
            warning: 'var(--color-warning)'
        };
        return colors[type] || colors.idle;
    }

    setProgress(percentage) {
        const progressFill = $('progressFill');
        const clampedPercent = Math.min(100, Math.max(0, percentage));
        progressFill.style.width = `${clampedPercent}%`;
        
        // Add completion animation
        if (clampedPercent === 100) {
            setTimeout(() => {
                progressFill.style.background = 'var(--gradient-success)';
                setTimeout(() => {
                    progressFill.style.background = 'var(--gradient-primary)';
                }, 1000);
            }, 200);
        }
    }

    showToast(message, type = 'info', duration = 4000) {
        const toast = $('toast');
        const toastMessage = $('toastMessage');
        const toastIcon = $('toastIcon');
        
        const icons = {
            success: '✅',
            error: '❌', 
            info: 'ℹ️',
            warning: '⚠️'
        };
        
        toastIcon.textContent = icons[type] || icons.info;
        toastMessage.textContent = message;
        
        toast.className = `toast ${type}`;
        toast.classList.add('show');
        
        setTimeout(() => {
            toast.classList.remove('show');
        }, duration);
        
        // Log toast events
        logEvent(analytics, 'toast_shown', { type, message: message.substring(0, 100) });
    }

    showModal(title, message, confirmText = 'Confirm', cancelText = 'Cancel') {
        return new Promise((resolve) => {
            $('modalTitle').textContent = title;
            $('modalMessage').textContent = message;
            $('modalConfirm').textContent = confirmText;
            $('modalCancel').textContent = cancelText;
            
            const overlay = $('modalOverlay');
            overlay.style.display = 'flex';
            requestAnimationFrame(() => {
                overlay.classList.add('show');
            });
            
            const handleConfirm = () => {
                this.hideModal();
                resolve(true);
            };
            
            const handleCancel = () => {
                this.hideModal();
                resolve(false);
            };
            
            // Remove existing listeners and add new ones
            const confirmBtn = $('modalConfirm');
            const cancelBtn = $('modalCancel');
            
            confirmBtn.replaceWith(confirmBtn.cloneNode(true));
            cancelBtn.replaceWith(cancelBtn.cloneNode(true));
            
            $('modalConfirm').addEventListener('click', handleConfirm);
            $('modalCancel').addEventListener('click', handleCancel);
        });
    }

    hideModal() {
        const overlay = $('modalOverlay');
        overlay.classList.remove('show');
        setTimeout(() => {
            overlay.style.display = 'none';
        }, 300);
    }

    showLoadingSkeleton() {
        const tbody = $('resultsTableBody');
        tbody.innerHTML = '';
        
        for (let i = 0; i < 10; i++) {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td><div class="skeleton" style="width: 20px; height: 20px; border-radius: var(--radius-sm);"></div></td>
                <td>
                    <div style="display: flex; align-items: center; gap: var(--space-4);">
                        <div class="skeleton skeleton-avatar"></div>
                        <div style="flex: 1;">
                            <div class="skeleton-text"></div>
                            <div class="skeleton-text" style="width: 60%;"></div>
                        </div>
                    </div>
                </td>
                <td><div class="skeleton-text"></div></td>
                <td><div class="skeleton-text"></div></td>
                <td><div class="skeleton-text"></div></td>
                <td><div class="skeleton-text"></div></td>
                <td><div class="skeleton-text"></div></td>
                <td><div class="skeleton-text"></div></td>
            `;
            tbody.appendChild(tr);
        }
    }

    hideLoadingSkeleton() {
        // This will be replaced when results are rendered
    }

    updateResultsCount(count, total = count) {
        $('resultsTitle').innerHTML = `🚀 Discovery Results <span style="color: var(--text-tertiary); font-weight: 400;">(${count}${total !== count ? ` of ${total}` : ''})</span>`;
    }

    animateStatsCounter(elementId, targetValue, duration = 2000) {
        const element = $(elementId);
        if (!element) return;
        
        const startValue = 0;
        const startTime = Date.now();
        
        const animate = () => {
            const elapsed = Date.now() - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            // Easing function
            const easeOut = 1 - Math.pow(1 - progress, 3);
            const currentValue = Math.floor(startValue + (targetValue - startValue) * easeOut);
            
            element.textContent = Utils.formatNumber(currentValue);
            
            if (progress < 1) {
                requestAnimationFrame(animate);
            }
        };
        
        requestAnimationFrame(animate);
    }
}

const uiManager = new UIManager();

/* ==========================================
   REVOLUTIONARY AUTHENTICATION SYSTEM
   ========================================== */

class AuthManager {
    constructor() {
        this.setupEventListeners();
        this.initializeAuth();
    }

    setupEventListeners() {
        $('btnSignIn').addEventListener('click', () => this.signIn());
        $('btnSignUp').addEventListener('click', () => this.signUp());
        $('btnSignOut').addEventListener('click', () => this.signOut());
        
        // Enter key support
        $('authPassword').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                this.signIn();
            }
        });
    }

    initializeAuth() {
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                await this.handleSignIn(user);
            } else {
                this.handleSignOut();
            }
        });
    }

    async handleSignIn(user) {
        stateManager.setState('user', user);
        
        // Smooth transition
        $('authView').style.transform = 'scale(0.95)';
        $('authView').style.opacity = '0';
        
        setTimeout(() => {
            $('appView').classList.remove('hidden');
            $('authView').style.display = 'none';
            
            // Entrance animation
            $('appView').style.transform = 'translateY(20px)';
            $('appView').style.opacity = '0';
            
            requestAnimationFrame(() => {
                $('appView').style.transition = 'all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
                $('appView').style.transform = 'translateY(0)';
                $('appView').style.opacity = '1';
            });
        }, 300);
        
        $('userInfo').textContent = user.email;
        
        // Enhanced user tracking
        try {
            const userRef = doc(db, 'users', user.uid);
            await setDoc(userRef, {
                email: user.email,
                lastLogin: Timestamp.now(),
                userAgent: navigator.userAgent,
                version: '1.0-next-gen',
                theme: uiManager.theme,
                features: ['ai-search', 'advanced-analytics', 'premium-export', 'social-links', 'growth-prediction']
            }, { merge: true });
            
            // Update usage statistics
            await updateDoc(userRef, {
                loginCount: increment(1)
            });
        } catch (error) {
            console.warn('User tracking failed:', error);
        }
        
        uiManager.showToast(`Welcome back, ${user.email.split('@')[0]}! 🚀`, 'success');
        
        // Log authentication event
        logEvent(analytics, 'login', { method: 'email' });
        
        // Load user settings
        await this.loadUserSettings(user.uid);
        
        // Initialize analytics counter animation
        this.updateStatsAnimation();
    }

    handleSignOut() {
        stateManager.setState('user', null);
        $('appView').classList.add('hidden');
        $('authView').style.display = 'flex';
        $('authView').style.transform = 'scale(1)';
        $('authView').style.opacity = '1';
        searchEngine.reset();
    }

    async signIn() {
        const email = $('authEmail').value.trim();
        const password = $('authPassword').value;
        
        if (!email || !password) {
            this.showAuthError('Please fill in all fields');
            return;
        }
        
        try {
            this.setAuthLoading('btnSignIn', 'Signing in...');
            await signInWithEmailAndPassword(auth, email, password);
        } catch (error) {
            this.showAuthError(`Sign-in failed: ${this.getAuthErrorMessage(error.code)}`);
            this.resetAuthLoading('btnSignIn', 'Sign In');
            
            // Log authentication error
            logEvent(analytics, 'login_failed', { error_code: error.code });
        }
    }

    async signUp() {
        const email = $('authEmail').value.trim();
        const password = $('authPassword').value;
        
        if (!email || !password) {
            this.showAuthError('Please fill in all fields');
            return;
        }
        
        if (password.length < 6) {
            this.showAuthError('Password must be at least 6 characters');
            return;
        }
        
        try {
            this.setAuthLoading('btnSignUp', 'Creating account...');
            await createUserWithEmailAndPassword(auth, email, password);
            
            // Log registration event
            logEvent(analytics, 'sign_up', { method: 'email' });
        } catch (error) {
            this.showAuthError(`Sign-up failed: ${this.getAuthErrorMessage(error.code)}`);
            this.resetAuthLoading('btnSignUp', 'Create Account');
            
            // Log registration error
            logEvent(analytics, 'sign_up_failed', { error_code: error.code });
        }
    }

    async signOut() {
        const confirmed = await uiManager.showModal(
            'Sign Out',
            'Are you sure you want to sign out?',
            'Sign Out',
            'Cancel'
        );
        
        if (confirmed) {
            try {
                await signOut(auth);
                uiManager.showToast('Signed out successfully', 'info');
                
                // Log signout event
                logEvent(analytics, 'logout');
            } catch (error) {
                uiManager.showToast('Failed to sign out. Please try again.', 'error');
            }
        }
    }

    setAuthLoading(buttonId, text) {
        const btn = $(buttonId);
        btn.disabled = true;
        btn.innerHTML = `<div class="spinner"></div><span>${text}</span>`;
    }

    resetAuthLoading(buttonId, text) {
        const btn = $(buttonId);
        btn.disabled = false;
        btn.innerHTML = `<span>${text}</span>`;
    }

    showAuthError(message) {
        const status = $('authStatus');
        status.textContent = message;
        status.style.color = 'var(--color-error)';
        status.classList.remove('hidden');
        setTimeout(() => status.classList.add('hidden'), 5000);
    }

    getAuthErrorMessage(code) {
        const messages = {
            'auth/user-not-found': 'No account found with this email',
            'auth/wrong-password': 'Incorrect password',
            'auth/email-already-in-use': 'An account already exists with this email',
            'auth/weak-password': 'Password is too weak',
            'auth/invalid-email': 'Invalid email address',
            'auth/too-many-requests': 'Too many failed attempts. Please try again later.',
            'auth/network-request-failed': 'Network error. Please check your connection.'
        };
        return messages[code] || 'An unexpected error occurred';
    }

    async loadUserSettings(uid) {
        try {
            const userDoc = await getDoc(doc(db, 'users', uid));
            if (userDoc.exists()) {
                const userData = userDoc.data();
                if (userData.settings) {
                    stateManager.setState('settings', { ...stateManager.getState('settings'), ...userData.settings });
                }
            }
        } catch (error) {
            console.warn('Failed to load user settings:', error);
        }
    }

    async saveUserSettings(uid, settings) {
        try {
            const userRef = doc(db, 'users', uid);
            await updateDoc(userRef, { settings });
            stateManager.setState('settings', settings);
        } catch (error) {
            console.warn('Failed to save user settings:', error);
        }
    }

    updateStatsAnimation() {
        // Animate the hero stats with realistic numbers
        uiManager.animateStatsCounter('totalChannels', 1234567);
        uiManager.animateStatsCounter('totalSearches', 67890);
    }
}

const authManager = new AuthManager();

/* ==========================================
   REVOLUTIONARY AI SEARCH ENGINE
   ========================================== */

class SearchEngine {
    constructor() {
        this.abortController = null;
        this.searchHistory = [];
        this.cache = new Map();
        this.setupEventListeners();
    }

    setupEventListeners() {
        $('btnSmartSearch').addEventListener('click', () => this.performSearch(false));
        $('btnAISearch').addEventListener('click', () => this.performAISearch());
        $('btnClear').addEventListener('click', () => this.clear());
        
        // Filter change handlers
        $('sortBy').addEventListener('change', () => this.applyFilters());
        $('minSubs').addEventListener('input', debounce(() => this.applyFilters(), CONFIG.SEARCH_DEBOUNCE));
        $('maxSubs').addEventListener('input', debounce(() => this.applyFilters(), CONFIG.SEARCH_DEBOUNCE));
        
        // Selection handlers
        $('btnSelectAll').addEventListener('click', () => this.selectAll());
        $('btnDeselectAll').addEventListener('click', () => this.deselectAll());
        
        // Export handlers
        $('btnExportCSV').addEventListener('click', () => this.exportCSV());
        $('btnExportJSON').addEventListener('click', () => this.exportJSON());
        $('btnCopyIDs').addEventListener('click', () => this.copyIDs());
        $('btnExportSelected').addEventListener('click', () => this.exportSelected());
        $('btnCopySelected').addEventListener('click', () => this.copySelected());
        
        // Clear results
        $('btnClearResults').addEventListener('click', () => this.confirmClearResults());
        
        // Library management
        $('btnSaveLibrary').addEventListener('click', () => this.saveLibrary());
        $('btnLoadLibrary').addEventListener('click', () => this.loadLibrary());
    }

    async performAISearch() {
        const query = $('searchQuery').value.trim();
        if (!query) {
            uiManager.showToast('Please enter search terms first', 'error');
            return;
        }
        
        if (!stateManager.getState('user')) {
            uiManager.showToast('Please sign in to use AI Deep Search', 'error');
            return;
        }
        
        const confirmed = await uiManager.showModal(
            'AI Deep Search',
            'AI Deep Search uses advanced algorithms to find high-quality channels by analyzing 20+ pages per query with intelligent filtering. This may consume more API credits. Continue?',
            'Start AI Search',
            'Cancel'
        );
        
        if (confirmed) {
            this.performSearch(true);
        }
    }

    async performSearch(isAISearch = false) {
        const queryRaw = $('searchQuery').value.trim();
        const queries = this.parseQueries(queryRaw);
        
        if (!queries.length) {
            uiManager.showToast('Please enter at least one search query', 'error');
            $('searchQuery').focus();
            return;
        }
        
        if (!stateManager.getState('user')) {
            uiManager.showToast('Please sign in to search', 'error');
            return;
        }
        
        const apiKey = $('apiKey').value.trim();
        if (!apiKey) {
            uiManager.showToast('Please enter your YouTube API key', 'error');
            $('apiKey').focus();
            return;
        }
        
        // Cancel previous search
        if (this.abortController) {
            this.abortController.abort();
        }
        this.abortController = new AbortController();
        
        // Get search parameters
        const searchParams = this.getSearchParameters(queries, isAISearch);
        const cacheKey = JSON.stringify(searchParams);
        
        // Check cache
        if (this.cache.has(cacheKey) && !isAISearch) {
            const cachedData = this.cache.get(cacheKey);
            if (Date.now() - cachedData.timestamp < 300000) { // 5 minutes
                stateManager.setState('channels', cachedData.data);
                this.applyFilters();
                uiManager.showToast('Results loaded from cache ⚡', 'info');
                return;
            }
        }
        
        this.reset();
        uiManager.setStatus('Initializing AI search...', 'loading');
        uiManager.setProgress(0);
        uiManager.showLoadingSkeleton();
        
        try {
            // Log search activity
            await this.logSearch(queryRaw, isAISearch, searchParams);
            
            const channelIds = await this.searchForChannels(queries, searchParams);
            
            if (channelIds.size === 0) {
                uiManager.setStatus('No channels found', 'idle');
                uiManager.showToast('No channels found. Try different search terms.', 'info');
                this.renderEmptyState();
                return;
            }
            
            uiManager.setStatus(`Analyzing ${channelIds.size} channels with AI...`, 'loading');
            
            const channels = await this.analyzeChannels(Array.from(channelIds), searchParams);
            
            if (this.abortController.signal.aborted) return;
            
            stateManager.setState('channels', channels);
            
            // Cache results
            if (channels.length > 0) {
                this.cache.set(cacheKey, {
                    data: channels.slice(),
                    timestamp: Date.now(),
                    searchType: isAISearch ? 'ai' : 'normal',
                    queryCount: queries.length
                });
                
                // Manage cache size
                if (this.cache.size > CONFIG.MAX_CACHE_SIZE) {
                    const oldestKey = this.cache.keys().next().value;
                    this.cache.delete(oldestKey);
                }
            }
            
            // Add to search history
            this.addToSearchHistory({
                query: queryRaw,
                timestamp: Date.now(),
                resultCount: channels.length,
                isAISearch
            });
            
            this.applyFilters();
            uiManager.setStatus(`AI discovered ${channels.length} high-quality channels`, 'success');
            uiManager.showToast(`🎉 ${isAISearch ? 'AI' : 'Smart'} search found ${channels.length} premium channels!`, 'success');
            uiManager.setProgress(100);
            
            // Log successful search
            logEvent(analytics, 'search_completed', {
                search_type: isAISearch ? 'ai' : 'normal',
                result_count: channels.length,
                query_count: queries.length
            });
            
        } catch (error) {
            if (error.name === 'AbortError') {
                uiManager.setStatus('Search cancelled', 'idle');
                uiManager.showToast('Search was cancelled', 'info');
            } else {
                console.error('Search error:', error);
                uiManager.setStatus('Search failed', 'error');
                uiManager.showToast(`Search failed: ${error.message}`, 'error');
                
                // Log search error
                logEvent(analytics, 'search_failed', {
                    error_message: error.message,
                    search_type: isAISearch ? 'ai' : 'normal'
                });
            }
            uiManager.setProgress(0);
            this.renderEmptyState();
        }
    }

    parseQueries(queryRaw) {
        return queryRaw
            .split(/[,\n]/)
            .map(q => q.trim())
            .filter(Boolean)
            .filter(q => q.length >= 2); // Minimum query length
    }

    getSearchParameters(queries, isAISearch) {
        return {
            queries,
            perPage: Math.max(1, Math.min(50, Number($('resultsPerPage').value) || 25)),
            pages: isAISearch ? 25 : Math.max(1, Math.min(20, Number($('pagesPerQuery').value) || 3)),
            order: $('orderBy').value,
            duration: $('duration').value,
            upload: $('uploadTime').value,
            region: $('region').value,
            isAISearch,
            enableAIAnalysis: $('enableAIAnalysis').checked,
            enableSocialLinks: $('enableSocialLinks').checked,
            enableGrowthPrediction: $('enableGrowthPrediction').checked,
            corsProxy: $('corsProxy').value.trim()
        };
    }

    async logSearch(query, isAISearch, params) {
        try {
            const user = stateManager.getState('user');
            await cloudFunctions.logSearch({
                query,
                isAISearch,
                timestamp: Date.now(),
                userAgent: navigator.userAgent,
                userId: user?.uid,
                filters: {
                    order: params.order,
                    duration: params.duration,
                    region: params.region,
                    upload: params.upload
                }
            });
        } catch (error) {
            console.warn('Search logging failed:', error);
        }
    }

    async searchForChannels(queries, params) {
        const channelIds = new Set();
        const totalSteps = queries.length * params.pages;
        let completed = 0;
        
        for (const [index, query] of queries.entries()) {
            uiManager.setStatus(`Searching "${query}"... (${index + 1}/${queries.length})`, 'loading');
            
            await this.searchVideosForQuery(
                query,
                params,
                channelIds,
                (progress) => {
                    completed = (index * params.pages) + progress;
                    uiManager.setProgress(completed / totalSteps * 0.7);
                }
            );
            
            if (this.abortController.signal.aborted) {
                throw new DOMException('Aborted', 'AbortError');
            }
        }
        
        return channelIds;
    }

    async searchVideosForQuery(query, params, channelIds, onProgress) {
        const apiKey = $('apiKey').value.trim();
        let pageToken = '';
        
        for (let page = 0; page < params.pages; page++) {
            if (!pageToken && page > 0) break;
            
            if (this.abortController.signal.aborted) {
                throw new DOMException('Aborted', 'AbortError');
            }
            
            const url = new URL('https://www.googleapis.com/youtube/v3/search');
            const searchParams = {
                part: 'snippet',
                type: 'video',
                q: query,
                maxResults: String(params.perPage),
                order: params.order,
                key: apiKey
            };
            
            if (params.region) searchParams.regionCode = params.region;
            if (params.duration) searchParams.videoDuration = params.duration;
            if (params.upload) searchParams.publishedAfter = this.getPublishedAfterISO(params.upload);
            if (pageToken) searchParams.pageToken = pageToken;
            
            Object.entries(searchParams).forEach(([key, value]) => {
                url.searchParams.set(key, value);
            });
            
            const response = await fetch(url.toString(), {
                signal: this.abortController.signal
            });
            
            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`YouTube API error (${response.status}): ${errorText}`);
            }
            
            const data = await response.json();
            
            // Advanced content filtering
            (data.items || []).forEach(item => {
                if (this.isHighQualityContent(item)) {
                    channelIds.add(item.snippet.channelId);
                }
            });
            
            pageToken = data.nextPageToken || '';
            onProgress(page + 1);
            
            // Intelligent rate limiting
            const delay = this.calculateRateLimit(response.headers);
            await sleep(delay);
        }
    }

    isHighQualityContent(item) {
        const title = (item.snippet.title || '').toLowerCase();
        const description = (item.snippet.description || '').toLowerCase();
        const channelTitle = (item.snippet.channelTitle || '').toLowerCase();
        
        // Advanced AI-powered quality filters
        const qualitySignals = {
            isShorts: this.detectShorts(title, description),
            isSpam: this.detectSpam(title, description, channelTitle),
            isLowEffort: this.detectLowEffort(title, description),
            hasGoodLength: title.length >= 10 && title.length <= 100,
            hasWords: title.split(' ').length >= 3,
            isClickbait: this.detectClickbait(title)
        };
        
        // Score content quality (0-100)
        let score = 50; // Base score
        
        if (!qualitySignals.isShorts) score += 20;
        if (!qualitySignals.isSpam) score += 15;
        if (!qualitySignals.isLowEffort) score += 10;
        if (qualitySignals.hasGoodLength) score += 10;
        if (qualitySignals.hasWords) score += 10;
        if (!qualitySignals.isClickbait) score += 5;
        
        // Additional quality checks
        if (description.length > 50) score += 5;
        if (item.snippet.thumbnails?.high?.url) score += 5;
        
        return score >= 70; // Only accept high-quality content
    }

    detectShorts(title, description) {
        const shortsKeywords = ['#shorts', 'shorts ', ' shorts', 'short video', 'quick tip'];
        return shortsKeywords.some(keyword => 
            title.includes(keyword) || description.includes(keyword)
        );
    }

    detectSpam(title, description, channelTitle) {
        const spamPatterns = [
            /^\d+$/,  // Only numbers
            /click here/i,
            /subscribe.*like.*share/i,
            /free.*download/i,
            /hack.*cheat.*bot/i,
            /easy.*money/i,
            /get.*rich.*quick/i
        ];
        
        const spamKeywords = [
            'clickbait', 'subscriber', 'sub4sub', 'like4like', 
            'follow4follow', 'giveaway', 'contest', 'prize'
        ];
        
        return spamPatterns.some(pattern => pattern.test(title)) ||
               spamKeywords.some(keyword => 
                   title.includes(keyword) || channelTitle.includes(keyword)
               );
    }

    detectLowEffort(title, description) {
        const lowEffortSignals = [
            title.length < 10,
            /^(test|video|untitled|new video)$/i.test(title.trim()),
            title.split(' ').length < 3,
            description.length < 20
        ];
        
        return lowEffortSignals.some(signal => signal);
    }

    detectClickbait(title) {
        const clickbaitPatterns = [
            /you won't believe/i,
            /this will shock you/i,
            /doctors hate/i,
            /\d+ reasons why/i,
            /what happens next/i,
            /gone wrong/i,
            /you need to see/i
        ];
        
        const excessiveCaps = (title.match(/[A-Z]/g) || []).length / title.length > 0.3;
        const excessiveEmojis = (title.match(/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F700}-\u{1F77F}]|[\u{1F780}-\u{1F7FF}]|[\u{1F800}-\u{1F8FF}]|[\u{1F900}-\u{1F9FF}]|[\u{1FA00}-\u{1FA6F}]|[\u{1FA70}-\u{1FAFF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu) || []).length > 3;
        
        return clickbaitPatterns.some(pattern => pattern.test(title)) ||
               excessiveCaps || excessiveEmojis;
    }

    calculateRateLimit(headers) {
        const remaining = parseInt(headers.get('X-RateLimit-Remaining')) || 1000;
        const resetTime = parseInt(headers.get('X-RateLimit-Reset')) || 3600;
        
        if (remaining < 100) return 500; // Slower when approaching limit
        if (remaining < 500) return 300;
        return CONFIG.RATE_LIMIT_DELAY;
    }

    async analyzeChannels(channelIds, params) {
        const channels = [];
        const batchSize = CONFIG.BATCH_SIZE;
        
        for (let i = 0; i < channelIds.length; i += batchSize) {
            if (this.abortController.signal.aborted) {
                throw new DOMException('Aborted', 'AbortError');
            }
            
            const batch = channelIds.slice(i, i + batchSize);
            const batchChannels = await this.analyzeChannelBatch(batch, params);
            channels.push(...batchChannels);
            
            uiManager.setProgress(0.7 + ((i + batchSize) / channelIds.length) * 0.3);
            
            const processed = Math.min(i + batchSize, channelIds.length);
            uiManager.setStatus(`AI analyzing channels... (${processed}/${channelIds.length})`, 'loading');
            
            await sleep(CONFIG.RATE_LIMIT_DELAY);
        }
        
        // Sort by AI quality score
        return channels.sort((a, b) => (b.qualityScore || 0) - (a.qualityScore || 0));
    }

    async analyzeChannelBatch(channelIds, params) {
        const apiKey = $('apiKey').value.trim();
        const url = new URL('https://www.googleapis.com/youtube/v3/channels');
        
        url.searchParams.set('part', 'snippet,statistics,brandingSettings,status,topicDetails,contentDetails');
        url.searchParams.set('id', channelIds.join(','));
        url.searchParams.set('key', apiKey);
        
        const response = await fetch(url.toString(), {
            signal: this.abortController.signal
        });
        
        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`Channels API error (${response.status}): ${errorText}`);
        }
        
        const data = await response.json();
        const channels = [];
        
        for (const channel of data.items || []) {
            if (!channel.snippet?.title) continue;
            
            const enrichedChannel = await this.enrichChannelData(channel, params);
            if (enrichedChannel) {
                channels.push(enrichedChannel);
            }
        }
        
        return channels;
    }

    async enrichChannelData(channel, params) {
        const stats = channel.statistics || {};
        const snippet = channel.snippet;
        const branding = channel.brandingSettings || {};
        const status = channel.status || {};
        const topics = channel.topicDetails || {};
        const content = channel.contentDetails || {};
        
        // Basic channel data
        const channelData = {
            id: Utils.generateId(),
            title: snippet.title,
            description: snippet.description || '',
            channelId: channel.id,
            customUrl: snippet.customUrl || '',
            
            // Statistics
            subs: Number(stats.subscriberCount || 0),
            views: Number(stats.viewCount || 0),
            videos: Number(stats.videoCount || 0),
            
            // Status
            verified: this.determineVerificationStatus(channel),
            hidden: !!stats.hiddenSubscriberCount,
            
            // Media
            avatar: this.getBestThumbnail(snippet.thumbnails),
            banner: branding.image?.bannerExternalUrl || '',
            
            // Location & time
            country: snippet.country || branding.channel?.country || '',
            language: snippet.defaultLanguage || branding.channel?.defaultLanguage || '',
            createdAt: snippet.publishedAt?.split('T')[0] || '',
            
            // Topics and keywords
            topics: (topics.topicCategories || []).map(cat => cat.split('/').pop()),
            keywords: branding.channel?.keywords || '',
            
            // Timestamps
            discoveredAt: new Date().toISOString()
        };
        
        // AI-powered analysis
        if (params.enableAIAnalysis) {
            channelData.qualityScore = this.calculateQualityScore(channel);
            channelData.engagementRate = this.calculateEngagementRate(stats);
            channelData.uploadFrequency = this.calculateUploadFrequency(content, stats);
        }
        
        // Growth prediction
        if (params.enableGrowthPrediction) {
            channelData.growthPotential = await this.predictGrowth(channel);
        }
        
        // Social links extraction
        if (params.enableSocialLinks && params.corsProxy) {
            channelData.socialLinks = await this.extractSocialLinks(channel.id, params.corsProxy);
        }
        
        return channelData;
    }

    getBestThumbnail(thumbnails) {
        if (!thumbnails) return '';
        return thumbnails.high?.url || 
               thumbnails.medium?.url || 
               thumbnails.default?.url || '';
    }

    determineVerificationStatus(channel) {
        const status = channel.status || {};
        const snippet = channel.snippet;
        const stats = channel.statistics || {};
        
        // Multiple verification signals
        const signals = [
            !!status.isLinked,
            !!snippet.customUrl,
            Number(stats.subscriberCount || 0) > 100000,
            !!status.longUploadsStatus,
            !stats.hiddenSubscriberCount
        ];
        
        const verificationScore = signals.filter(Boolean).length;
        return verificationScore >= 3 ? 'Yes' : 'No';
    }

    calculateQualityScore(channel) {
        const stats = channel.statistics || {};
        const snippet = channel.snippet;
        const status = channel.status || {};
        
        let score = 0;
        
        // Subscriber quality (0-30 points)
        const subs = Number(stats.subscriberCount || 0);
        if (subs > 10000000) score += 30;
        else if (subs > 1000000) score += 25;
        else if (subs > 100000) score += 20;
        else if (subs > 10000) score += 15;
        else if (subs > 1000) score += 10;
        else if (subs > 100) score += 5;
        
        // View-to-subscriber ratio (0-25 points)
        const views = Number(stats.viewCount || 0);
        const videos = Number(stats.videoCount || 1);
        const avgViews = views / Math.max(videos, 1);
        const viewsPerSub = subs > 0 ? avgViews / subs : 0;
        
        if (viewsPerSub > 20) score += 25;
        else if (viewsPerSub > 10) score += 20;
        else if (viewsPerSub > 5) score += 15;
        else if (viewsPerSub > 1) score += 10;
        else if (viewsPerSub > 0.5) score += 5;
        
        // Content consistency (0-20 points)
        if (videos > 2000) score += 20;
        else if (videos > 1000) score += 18;
        else if (videos > 500) score += 15;
        else if (videos > 100) score += 12;
        else if (videos > 50) score += 8;
        else if (videos > 10) score += 4;
        
        // Verification and quality signals (0-25 points)
        if (status.isLinked) score += 10;
        if (snippet.customUrl) score += 8;
        if (!stats.hiddenSubscriberCount) score += 7;
        
        // Description quality
        const desc = snippet.description || '';
        if (desc.length > 1000) score += 10;
        else if (desc.length > 500) score += 7;
        else if (desc.length > 200) score += 4;
        else if (desc.length > 50) score += 2;
        
        // Thumbnail quality
        if (snippet.thumbnails?.high?.url) score += 5;
        else if (snippet.thumbnails?.medium?.url) score += 3;
        
        return Math.min(100, score);
    }

    calculateEngagementRate(stats) {
        const subs = Number(stats.subscriberCount || 0);
        const views = Number(stats.viewCount || 0);
        const videos = Number(stats.videoCount || 1);
        
        if (subs === 0) return 0;
        const avgViewsPerVideo = views / videos;
        return Math.min(100, (avgViewsPerVideo / subs) * 100);
    }

    calculateUploadFrequency(content, stats) {
        const videos = Number(stats.videoCount || 0);
        const createdAt = new Date(content.relatedPlaylists?.uploads || Date.now());
        const daysSinceCreation = (Date.now() - createdAt.getTime()) / (1000 * 60 * 60 * 24);
        
        if (daysSinceCreation <= 0 || videos === 0) return 'Unknown';
        
        const videosPerDay = videos / daysSinceCreation;
        
        if (videosPerDay >= 1) return 'Daily';
        if (videosPerDay >= 0.5) return 'Every 2 days';
        if (videosPerDay >= 0.14) return 'Weekly';
        if (videosPerDay >= 0.07) return 'Bi-weekly';
        if (videosPerDay >= 0.033) return 'Monthly';
        return 'Infrequent';
    }

    async predictGrowth(channel) {
        try {
            const result = await cloudFunctions.predictGrowth({
                channelId: channel.id,
                stats: channel.statistics,
                snippet: channel.snippet
            });
            return result.data.prediction || 'Unknown';
        } catch (error) {
            console.warn('Growth prediction failed:', error);
            
            // Fallback local prediction
            const stats = channel.statistics || {};
            const subs = Number(stats.subscriberCount || 0);
            const videos = Number(stats.videoCount || 0);
            const views = Number(stats.viewCount || 0);
            
            const avgViews = views / Math.max(videos, 1);
            const viewsPerSub = subs > 0 ? avgViews / subs : 0;
            
            if (subs < 10000 && viewsPerSub > 5) return 'High';
            if (subs < 100000 && viewsPerSub > 2) return 'Medium';
            if (viewsPerSub > 1) return 'Low';
            return 'Minimal';
        }
    }

    async extractSocialLinks(channelId, corsProxy) {
        try {
            const result = await cloudFunctions.extractSocialLinks({
                channelId,
                corsProxy
            });
            return result.data.socialLinks || {};
        } catch (error) {
            console.warn('Social links extraction failed:', error);
            
            // Fallback local extraction
            try {
                const aboutUrl = `${corsProxy}https://www.youtube.com/channel/${channelId}/about`;
                const response = await fetch(aboutUrl, { 
                    signal: this.abortController?.signal 
                });
                
                if (!response.ok) return {};
                
                const html = await response.text();
                return this.parseSocialLinksFromHTML(html);
            } catch (error) {
                console.warn('Fallback social links extraction failed:', error);
                return {};
            }
        }
    }

    parseSocialLinksFromHTML(html) {
        const socialLinks = {};
        const linkPatterns = {
            twitter: /twitter\.com\/[\w]+/gi,
            instagram: /instagram\.com\/[\w.]+/gi,
            facebook: /facebook\.com\/[\w.]+/gi,
            tiktok: /tiktok\.com\/@[\w.]+/gi,
            linkedin: /linkedin\.com\/in\/[\w-]+/gi,
            website: /https?:\/\/[\w.-]+\.[a-z]{2,}/gi
        };
        
        Object.entries(linkPatterns).forEach(([platform, pattern]) => {
            const matches = html.match(pattern);
            if (matches && matches.length > 0) {
                socialLinks[platform] = 'https://' + matches[0].replace(/^https?:\/\//, '');
            }
        });
        
        return socialLinks;
    }

    getPublishedAfterISO(timeframe) {
        const date = new Date();
        switch (timeframe) {
            case 'hour': date.setHours(date.getHours() - 1); break;
            case 'today': date.setDate(date.getDate() - 1); break;
            case 'week': date.setDate(date.getDate() - 7); break;
            case 'month': date.setMonth(date.getMonth() - 1); break;
            default: return '';
        }
        return date.toISOString();
    }

    applyFilters() {
        const channels = stateManager.getState('channels') || [];
        const minSubs = Number($('minSubs').value || 0);
        const maxSubs = Number($('maxSubs').value || 0);
        const searchTerm = $('searchInResults').value.trim().toLowerCase();
        
        let filteredChannels = channels.filter(channel => {
            // Subscriber filters
            if (channel.subs < minSubs) return false;
            if (maxSubs > 0 && channel.subs > maxSubs) return false;
            
            // Advanced search filter
            if (searchTerm) {
                const searchableContent = [
                    channel.title,
                    channel.channelId,
                    channel.description,
                    channel.country,
                    channel.keywords || '',
                    channel.topics?.join(' ') || ''
                ].join(' ').toLowerCase();
                
                // Support for multiple search terms and operators
                const searchTerms = searchTerm.split(' ').filter(Boolean);
                const hasAllTerms = searchTerms.every(term => {
                    if (term.startsWith('-')) {
                        // Exclude operator
                        return !searchableContent.includes(term.substring(1));
                    }
                    return searchableContent.includes(term);
                });
                
                if (!hasAllTerms) return false;
            }
            
            return true;
        });
        
        // Advanced sorting
        const sortBy = $('sortBy').value;
        filteredChannels.sort((a, b) => {
            switch (sortBy) {
                case 'quality-desc': return (b.qualityScore || 0) - (a.qualityScore || 0);
                case 'subs-desc': return (b.subs || 0) - (a.subs || 0);
                case 'subs-asc': return (a.subs || 0) - (b.subs || 0);
                case 'views-desc': return (b.views || 0) - (a.views || 0);
                case 'views-asc': return (a.views || 0) - (b.views || 0);
                case 'engagement-desc': return (b.engagementRate || 0) - (a.engagementRate || 0);
                case 'growth-desc': 
                    const growthOrder = { 'High': 3, 'Medium': 2, 'Low': 1, 'Minimal': 0 };
                    return (growthOrder[b.growthPotential] || 0) - (growthOrder[a.growthPotential] || 0);
                case 'title-asc': return (a.title || '').localeCompare(b.title || '');
                case 'title-desc': return (b.title || '').localeCompare(a.title || '');
                default: return (b.qualityScore || 0) - (a.qualityScore || 0);
            }
        });
        
        stateManager.setState('filteredChannels', filteredChannels);
        this.renderResults(filteredChannels);
        uiManager.updateResultsCount(filteredChannels.length, stateManager.getState('channels').length);
    }

    renderResults(channels) {
        const tbody = $('resultsTableBody');
        
        if (!channels.length) {
            this.renderEmptyState();
            return;
        }
        
        tbody.innerHTML = '';
        
        channels.forEach((channel, index) => {
            const tr = document.createElement('tr');
            tr.dataset.channelId = channel.channelId;
            tr.innerHTML = `
                <td>
                    <input type="checkbox" class="channel-checkbox" data-index="${index}">
                </td>
                <td>
                    <div class="channel-info">
                        <img class="channel-avatar" 
                             src="${Utils.sanitize(channel.avatar)}" 
                             alt="${Utils.sanitize(channel.title)}" 
                             loading="lazy"
                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTYiIGhlaWdodD0iNTYiIHZpZXdCb3g9IjAgMCA1NiA1NiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjU2IiBoZWlnaHQ9IjU2IiByeD0iMTYiIGZpbGw9IiNGNUY1RjUiLz4KPHN2ZyB4PSIxNiIgeT0iMTYiIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM5Q0EzQUYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Im0yMCAyMS0yLTJtLTMtNWExMiAxMiAwIDEgMC0xMS41IDcuNWExMi4wOSAxMi4wOSAwIDAgMCA3LjUgMi41eiIvPgo8L3N2Zz4KPC9zdmc+'">
                        <div class="channel-details">
                            <h4>${this.highlightSearchTerms(Utils.sanitize(channel.title))}</h4>
                            <p>${Utils.sanitize(channel.channelId)}</p>
                        </div>
                    </div>
                </td>
                <td class="font-semibold">
                    ${channel.hidden ? 
                        '<span style="color: var(--text-tertiary);">Hidden</span>' : 
                        Utils.formatNumber(channel.subs)}
                </td>
                <td>${Utils.formatNumber(channel.videos)}</td>
                <td>${Utils.formatNumber(channel.views)}</td>
                <td>
                    <div style="display: flex; align-items: center; gap: var(--space-2);">
                        <div class="quality-bar" style="width: 40px; height: 6px; background: var(--bg-tertiary); border-radius: var(--radius-full); overflow: hidden;">
                            <div style="width: ${channel.qualityScore || 0}%; height: 100%; background: var(--gradient-primary);"></div>
                        </div>
                        <span class="text-tiny">${channel.qualityScore || 0}</span>
                    </div>
                </td>
                <td>
                    ${channel.verified === 'Yes' ? 
                        '<div class="badge badge-verified">✓ Verified</div>' : 
                        '<span style="color: var(--text-tertiary);">—</span>'}
                </td>
                <td>
                    <span class="text-small">${Utils.sanitize(channel.country) || '—'}</span>
                    ${channel.growthPotential ? 
                        `<br><span class="badge" style="background: var(--gradient-${this.getGrowthColor(channel.growthPotential)}); color: white; font-size: 10px;">📈 ${channel.growthPotential}</span>` : 
                        ''}
                </td>
            `;
            
            // Add click handler for details view
            tr.addEventListener('click', (e) => {
                if (e.target.type !== 'checkbox') {
                    this.renderChannelDetails(channel);
                    
                    // Visual selection feedback
                    $$('.table tbody tr').forEach(row => row.classList.remove('selected'));
                    tr.classList.add('selected');
                }
            });
            
            // Add checkbox change handler
            const checkbox = tr.querySelector('.channel-checkbox');
            checkbox.addEventListener('change', (e) => {
                const selectedChannels = stateManager.getState('selectedChannels');
                if (e.target.checked) {
                    selectedChannels.add(channel.id);
                } else {
                    selectedChannels.delete(channel.id);
                }
                stateManager.setState('selectedChannels', selectedChannels);
            });
            
            tbody.appendChild(tr);
        });
    }

    renderEmptyState() {
        const tbody = $('resultsTableBody');
        const channels = stateManager.getState('channels') || [];
        
        tbody.innerHTML = `
            <tr>
                <td colspan="8">
                    <div class="empty-state">
                        <div class="empty-state-icon">${channels.length === 0 ? '🚀' : '🎯'}</div>
                        <div class="empty-state-title">
                            ${channels.length === 0 ? 'Ready to Discover' : 'No Matches Found'}
                        </div>
                        <div class="empty-state-description">
                            ${channels.length === 0 ? 
                                'Enter your search terms and let our Advanced AI discover amazing YouTube channels for you.' : 
                                'Try adjusting your filters or search terms to see more channels.'}
                        </div>
                    </div>
                </td>
            </tr>
        `;
    }

    highlightSearchTerms(text) {
        const searchTerm = $('searchInResults').value.trim();
        if (!searchTerm) return text;
        
        const regex = new RegExp(`(${searchTerm.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
        return text.replace(regex, '<mark>$1</mark>');
    }

    getGrowthColor(growthPotential) {
        const colorMap = {
            'High': 'success',
            'Medium': 'warning',
            'Low': 'primary',
            'Minimal': 'tertiary'
        };
        return colorMap[growthPotential] || 'primary';
    }

    renderChannelDetails(channel) {
        const content = $('detailsContent');
        $('detailsTitle').textContent = `📊 ${channel.title}`;
        
        // Show loading state first
        content.innerHTML = `
            <div style="text-align: center; padding: var(--space-8);">
                <div class="spinner" style="margin: 0 auto var(--space-4);"></div>
                <p class="text-small">Loading detailed analytics...</p>
            </div>
        `;
        
        // Simulate loading delay for smooth UX
        setTimeout(() => {
            content.innerHTML = `
                <div class="channel-details-content">
                    ${channel.banner ? `
                        <div class="channel-banner" style="
                            height: 120px; 
                            background-image: url('${Utils.sanitize(channel.banner)}');
                            background-size: cover;
                            background-position: center;
                            border-radius: var(--radius-2xl);
                            margin-bottom: var(--space-6);
                            position: relative;
                            overflow: hidden;
                        ">
                            <div style="position: absolute; inset: 0; background: linear-gradient(45deg, rgba(0,0,0,0.3), transparent);"></div>
                        </div>
                    ` : ''}
                    
                    <div class="channel-header" style="display: flex; align-items: center; gap: var(--space-4); margin-bottom: var(--space-6);">
                        <img class="channel-avatar" src="${Utils.sanitize(channel.avatar)}" alt="${Utils.sanitize(channel.title)}" style="width: 80px; height: 80px;">
                        <div style="flex: 1;">
                            <h3 class="text-title">${Utils.sanitize(channel.title)}</h3>
                            <p class="text-small" style="margin: var(--space-2) 0;">
                                <span style="font-family: var(--font-mono);">${Utils.sanitize(channel.channelId)}</span>
                                ${channel.country ? ` • ${Utils.sanitize(channel.country)}` : ''}
                                ${channel.createdAt ? ` • Created: ${channel.createdAt}` : ''}
                            </p>
                            <div style="display: flex; gap: var(--space-2); margin-top: var(--space-2);">
                                ${channel.verified === 'Yes' ? '<div class="badge badge-verified">✓ Verified</div>' : ''}
                                ${channel.qualityScore >= 80 ? '<div class="badge badge-premium">⭐ Premium</div>' : ''}
                                ${channel.growthPotential === 'High' ? '<div class="badge badge-ai">🚀 High Growth</div>' : ''}
                            </div>
                        </div>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value">${channel.hidden ? 'Hidden' : Utils.formatNumber(channel.subs)}</div>
                            <div class="stat-label">Subscribers</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${Utils.formatNumber(channel.views)}</div>
                            <div class="stat-label">Total Views</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${Utils.formatNumber(channel.videos)}</div>
                            <div class="stat-label">Videos</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${channel.qualityScore || 0}</div>
                            <div class="stat-label">AI Quality</div>
                        </div>
                        ${channel.engagementRate ? `
                        <div class="stat-card">
                            <div class="stat-value">${channel.engagementRate.toFixed(1)}%</div>
                            <div class="stat-label">Engagement</div>
                        </div>
                        ` : ''}
                        ${channel.growthPotential ? `
                        <div class="stat-card">
                            <div class="stat-value">${channel.growthPotential}</div>
                            <div class="stat-label">Growth</div>
                        </div>
                        ` : ''}
                    </div>
                    
                    ${channel.description ? `
                        <div class="mt-4">
                            <h4 class="text-lg font-semibold mb-3">📝 Description</h4>
                            <div style="background: var(--bg-secondary); padding: var(--space-4); border-radius: var(--radius-xl); max-height: 200px; overflow-y: auto;">
                                <p class="text-small" style="line-height: 1.6; white-space: pre-wrap;">${Utils.sanitize(channel.description)}</p>
                            </div>
                        </div>
                    ` : ''}
                    
                    ${channel.topics && channel.topics.length > 0 ? `
                        <div style="margin-top: var(--space-6);">
                            <h4 class="text-lg font-semibold mb-3">🏷️ Topics</h4>
                            <div style="display: flex; flex-wrap: wrap; gap: var(--space-2);">
                                ${channel.topics.map(topic => 
                                    `<span class="badge" style="background: var(--bg-tertiary); color: var(--text-secondary); font-weight: 500;">${Utils.sanitize(topic)}</span>`
                                ).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    ${channel.socialLinks && Object.keys(channel.socialLinks).length > 0 ? `
                        <div style="margin-top: var(--space-6);">
                            <h4 class="text-lg font-semibold mb-3">🔗 Social Links</h4>
                            <div style="display: flex; flex-wrap: wrap; gap: var(--space-2);">
                                ${Object.entries(channel.socialLinks).map(([platform, url]) => 
                                    `<a href="${Utils.sanitize(url)}" target="_blank" class="btn btn-sm btn-ghost">${this.getPlatformEmoji(platform)} ${platform}</a>`
                                ).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    <div style="margin-top: var(--space-6);">
                        <h4 class="text-lg font-semibold mb-3">⚡ Quick Actions</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: var(--space-2);">
                            <a href="https://www.youtube.com/channel/${channel.channelId}" target="_blank" class="btn btn-primary btn-sm">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"/>
                                    <polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"/>
                                </svg>
                                Visit Channel
                            </a>
                            <button class="btn btn-sm" onclick="navigator.clipboard.writeText('${channel.channelId}').then(() => uiManager.showToast('Channel ID copied!', 'success'))">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                                </svg>
                                Copy ID
                            </button>
                            <button class="btn btn-sm" onclick="searchEngine.exportSingleChannel('${channel.id}')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7,10 12,15 17,10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                Export
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }, 300);
    }

    getPlatformEmoji(platform) {
        const emojis = {
            twitter: '🐦',
            instagram: '📸',
            facebook: '👥',
            tiktok: '🎵',
            linkedin: '💼',
            website: '🌐'
        };
        return emojis[platform.toLowerCase()] || '🔗';
    }

    // Selection methods
    selectAll() {
        const checkboxes = $$('.channel-checkbox');
        const selectedChannels = stateManager.getState('selectedChannels');
        
        checkboxes.forEach(checkbox => {
            checkbox.checked = true;
            const index = parseInt(checkbox.dataset.index);
            const channel = stateManager.getState('filteredChannels')[index];
            if (channel) {
                selectedChannels.add(channel.id);
            }
        });
        
        stateManager.setState('selectedChannels', selectedChannels);
        uiManager.showToast(`Selected ${checkboxes.length} channels`, 'success');
    }

    deselectAll() {
        const checkboxes = $$('.channel-checkbox');
        checkboxes.forEach(checkbox => {
            checkbox.checked = false;
        });
        
        stateManager.setState('selectedChannels', new Set());
        uiManager.showToast('All channels deselected', 'info');
    }

    getSelectedChannels() {
        const selectedChannels = [];
        const selectedIds = stateManager.getState('selectedChannels');
        const allChannels = stateManager.getState('filteredChannels') || [];
        
        allChannels.forEach(channel => {
            if (selectedIds.has(channel.id)) {
                selectedChannels.push(channel);
            }
        });
        
        return selectedChannels;
    }

    // Export methods
    async exportCSV() {
        const channels = stateManager.getState('filteredChannels') || [];
        if (!channels.length) {
            uiManager.showToast('No data to export. Please perform a search first.', 'warning');
            return;
        }
        
        const csv = Utils.generateCSV(channels);
        const filename = `youtube_channels_${new Date().toISOString().slice(0, 10)}.csv`;
        Utils.downloadFile(csv, filename, 'text/csv');
        uiManager.showToast(`Exported ${channels.length} channels to ${filename}`, 'success');
        
        // Log export event
        logEvent(analytics, 'export_csv', { channel_count: channels.length });
    }

    async exportJSON() {
        const channels = stateManager.getState('filteredChannels') || [];
        if (!channels.length) {
            uiManager.showToast('No data to export. Please perform a search first.', 'warning');
            return;
        }
        
        const json = JSON.stringify(channels, null, 2);
        const filename = `youtube_channels_${new Date().toISOString().slice(0, 10)}.json`;
        Utils.downloadFile(json, filename, 'application/json');
        uiManager.showToast(`Exported ${channels.length} channels to ${filename}`, 'success');
        
        // Log export event
        logEvent(analytics, 'export_json', { channel_count: channels.length });
    }

    async copyIDs() {
        const channels = stateManager.getState('filteredChannels') || [];
        if (!channels.length) {
            uiManager.showToast('No data to copy. Please perform a search first.', 'warning');
            return;
        }
        
        const ids = channels.map(channel => channel.channelId).join('\n');
        const success = await Utils.copyToClipboard(ids);
        
        if (success) {
            uiManager.showToast(`Copied ${channels.length} channel IDs to clipboard`, 'success');
        } else {
            uiManager.showToast('Failed to copy to clipboard', 'error');
        }
    }

    async exportSelected() {
        const selectedChannels = this.getSelectedChannels();
        if (!selectedChannels.length) {
            uiManager.showToast('Please select channels to export', 'warning');
            return;
        }
        
        const csv = Utils.generateCSV(selectedChannels);
        const filename = `selected_channels_${new Date().toISOString().slice(0, 10)}.csv`;
        Utils.downloadFile(csv, filename, 'text/csv');
        uiManager.showToast(`Exported ${selectedChannels.length} selected channels`, 'success');
        
        // Log export event
        logEvent(analytics, 'export_selected', { channel_count: selectedChannels.length });
    }

    async copySelected() {
        const selectedChannels = this.getSelectedChannels();
        if (!selectedChannels.length) {
            uiManager.showToast('Please select channels to copy', 'warning');
            return;
        }
        
        const csv = Utils.generateCSV(selectedChannels);
        const success = await Utils.copyToClipboard(csv);
        
        if (success) {
            uiManager.showToast(`Copied ${selectedChannels.length} selected channels to clipboard`, 'success');
        } else {
            uiManager.showToast('Failed to copy to clipboard', 'error');
        }
    }

    exportSingleChannel(channelId) {
        const channels = stateManager.getState('channels') || [];
        const channel = channels.find(ch => ch.id === channelId);
        
        if (!channel) {
            uiManager.showToast('Channel not found', 'error');
            return;
        }
        
        const csv = Utils.generateCSV([channel]);
        const filename = `${channel.title.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().slice(0, 10)}.csv`;
        Utils.downloadFile(csv, filename, 'text/csv');
        uiManager.showToast('Channel data exported', 'success');
    }

    async confirmClearResults() {
        const confirmed = await uiManager.showModal(
            'Clear Results',
            'Are you sure you want to clear all search results? This action cannot be undone.',
            'Clear Results',
            'Cancel'
        );
        
        if (confirmed) {
            this.reset();
            uiManager.showToast('All search results have been cleared', 'info');
        }
    }

    // Library management
    async saveLibrary() {
        const channels = stateManager.getState('channels') || [];
        if (!channels.length) {
            uiManager.showToast('No channels to save. Please perform a search first.', 'warning');
            return;
        }
        
        try {
            const libraryData = {
                channels,
                timestamp: Date.now(),
                version: '1.0',
                userAgent: navigator.userAgent
            };
            
            localStorage.setItem(CONFIG.LIBRARY_KEY, JSON.stringify(libraryData));
            uiManager.showToast(`Saved ${channels.length} channels to local library`, 'success');
            
            // Log library save
            logEvent(analytics, 'library_saved', { channel_count: channels.length });
        } catch (error) {
            console.error('Library save error:', error);
            uiManager.showToast('Failed to save library. Storage might be full.', 'error');
        }
    }

    async loadLibrary() {
        try {
            const data = localStorage.getItem(CONFIG.LIBRARY_KEY);
            if (!data) {
                uiManager.showToast('No saved library found', 'info');
                return;
            }
            
            const libraryData = JSON.parse(data);
            if (!libraryData.channels || !Array.isArray(libraryData.channels)) {
                throw new Error('Invalid library format');
            }
            
            stateManager.setState('channels', libraryData.channels);
            this.applyFilters();
            uiManager.showToast(`Loaded ${libraryData.channels.length} channels from library`, 'success');
            
            // Log library load
            logEvent(analytics, 'library_loaded', { channel_count: libraryData.channels.length });
        } catch (error) {
            console.error('Library load error:', error);
            uiManager.showToast('Failed to load library. Data may be corrupted.', 'error');
        }
    }

    addToSearchHistory(searchData) {
        this.searchHistory.unshift(searchData);
        
        // Limit search history size
        if (this.searchHistory.length > CONFIG.MAX_SEARCH_HISTORY) {
            this.searchHistory = this.searchHistory.slice(0, CONFIG.MAX_SEARCH_HISTORY);
        }
        
        // Save to localStorage
        try {
            localStorage.setItem('search_history', JSON.stringify(this.searchHistory));
        } catch (error) {
            console.warn('Failed to save search history:', error);
        }
    }

    clear() {
        $('searchQuery').value = '';
        this.reset();
        uiManager.showToast('Search cleared', 'info');
    }

    reset() {
        stateManager.setState('channels', []);
        stateManager.setState('filteredChannels', []);
        stateManager.setState('selectedChannels', new Set());
        
        this.renderEmptyState();
        uiManager.setStatus('Ready', 'idle');
        uiManager.setProgress(0);
        uiManager.updateResultsCount(0);
        
        // Reset details panel
        $('detailsTitle').textContent = '📊 Channel Analytics';
        $('detailsContent').innerHTML = `
            <div class="empty-state">
                <div class="empty-state-icon">👆</div>
                <div class="empty-state-title">Select a Channel</div>
                <div class="empty-state-description">
                    Click on any channel from the results table to view detailed 
                    analytics and AI-powered insights.
                </div>
            </div>
        `;
    }
}

const searchEngine = new SearchEngine();

/* ==========================================
   INITIALIZATION
   ========================================== */

// Initialize the application when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    console.log('🚀 Lead Studio Pro Next Gen - Initialized');
    
    // Initialize theme
    uiManager.initializeTheme();
    
    // Set initial status
    uiManager.setStatus('Ready', 'idle');
    
    // Load search history
    try {
        const history = localStorage.getItem('search_history');
        if (history) {
            searchEngine.searchHistory = JSON.parse(history);
        }
    } catch (error) {
        console.warn('Failed to load search history:', error);
    }
    
    // Performance monitoring
    if ('performance' in window) {
        window.addEventListener('load', () => {
            const loadTime = Math.round(performance.now());
            console.log(`⚡ App loaded in ${loadTime}ms`);
            
            // Log performance
            logEvent(analytics, 'app_performance', { load_time: loadTime });
        });
    }
    
    // Add global error handling
    window.addEventListener('error', (event) => {
        console.error('Global error:', event.error);
        uiManager.showToast('An unexpected error occurred. Please try again.', 'error');
        
        // Log error
        logEvent(analytics, 'app_error', {
            error_message: event.error?.message || 'Unknown error',
            error_stack: event.error?.stack?.substring(0, 500) || 'No stack trace'
        });
    });
    
    // Add unhandled promise rejection handling
    window.addEventListener('unhandledrejection', (event) => {
        console.error('Unhandled promise rejection:', event.reason);
        uiManager.showToast('An unexpected error occurred. Please try again.', 'error');
        
        // Log error
        logEvent(analytics, 'promise_rejection', {
            error_message: event.reason?.message || 'Unknown rejection',
            error_stack: event.reason?.stack?.substring(0, 500) || 'No stack trace'
        });
    });
    
    // Log app initialization
    logEvent(analytics, 'app_initialized', {
        timestamp: Date.now(),
        user_agent: navigator.userAgent,
        screen_resolution: `${screen.width}x${screen.height}`,
        viewport_size: `${window.innerWidth}x${window.innerHeight}`
    });
});

// Export for global access
window.searchEngine = searchEngine;
window.uiManager = uiManager;
window.authManager = authManager;
window.stateManager = stateManager;

</script>
</body>
</html>
